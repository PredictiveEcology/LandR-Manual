<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 LandR Biomass_validationKNN Module | LandR Manual</title>
<meta name="description" content="7.0.0.1 Authors: Ceres Barros ceres.barros@ubc.ca [aut, cre], Eliot McIntire eliot.mcintire@nrcan-rncan.gc.ca [aut] This documentation is work in progress. Potential discrepancies and omissions...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 7 LandR Biomass_validationKNN Module | LandR Manual">
<meta property="og:type" content="book">
<meta property="og:url" content="https://predictiveecology.github.io/LandR-Manual/landr-biomass_validationknn-module.html">
<meta property="og:image" content="https://predictiveecology.github.io/LandR-Manual/figures/LandRHex.png">
<meta property="og:description" content="7.0.0.1 Authors: Ceres Barros ceres.barros@ubc.ca [aut, cre], Eliot McIntire eliot.mcintire@nrcan-rncan.gc.ca [aut] This documentation is work in progress. Potential discrepancies and omissions...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 7 LandR Biomass_validationKNN Module | LandR Manual">
<meta name="twitter:description" content="7.0.0.1 Authors: Ceres Barros ceres.barros@ubc.ca [aut, cre], Eliot McIntire eliot.mcintire@nrcan-rncan.gc.ca [aut] This documentation is work in progress. Potential discrepancies and omissions...">
<meta name="twitter:image" content="https://predictiveecology.github.io/LandR-Manual/figures/LandRHex.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="v. 1.0.0">LandR Manual</a>:
        <small class="text-muted">v. 1.0.0</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="landr-biomass_core-module.html"><span class="header-section-number">1</span> LandR Biomass_core Module</a></li>
<li><a class="" href="landr-data-and-calibration-modules.html"><span class="header-section-number">2</span> LandR Data and Calibration Modules</a></li>
<li><a class="" href="landr-biomass_speciesdata-module.html"><span class="header-section-number">3</span> LandR Biomass_speciesData Module</a></li>
<li><a class="" href="landr-biomass_borealdataprep-module.html"><span class="header-section-number">4</span> LandR Biomass_borealDataPrep Module</a></li>
<li><a class="" href="landr-biomass_speciesparameters-module.html"><span class="header-section-number">5</span> LandR Biomass_speciesParameters Module</a></li>
<li><a class="" href="landr-validation-modules.html"><span class="header-section-number">6</span> LandR Validation Modules</a></li>
<li><a class="active" href="landr-biomass_validationknn-module.html"><span class="header-section-number">7</span> LandR Biomass_validationKNN Module</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/PredictiveEcology/LandR-Manual">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="landr-biomass_validationknn-module" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> LandR <em>Biomass_validationKNN</em> Module<a class="anchor" aria-label="anchor" href="#landr-biomass_validationknn-module"><i class="fas fa-link"></i></a>
</h1>
<!-- the following are text references used in captions for LaTeX compatibility -->

<p><a href="https://github.com/PredictiveEcology/Biomass_validationKNN"><img src="modules/Biomass_validationKNN/figures/moduleVersionBadge.png" alt="module-version-Badge"></a></p>
<p><a href="https://github.com/PredictiveEcology/Biomass_validationKNN/issues"><img src="modules/Biomass_validationKNN/figures/issuesBadge.png" alt="Issues-badge"></a></p>
<!-- if knitting to pdf remember to add the pandoc_args: ["--extract-media", "."] option to yml in order to get the badge images -->
<div id="authors-4" class="section level4" number="7.0.0.1">
<h4>
<span class="header-section-number">7.0.0.1</span> Authors:<a class="anchor" aria-label="anchor" href="#authors-4"><i class="fas fa-link"></i></a>
</h4>
<p>Ceres Barros <a href="mailto:ceres.barros@ubc.ca" class="email">ceres.barros@ubc.ca</a> [aut, cre], Eliot McIntire <a href="mailto:eliot.mcintire@nrcan-rncan.gc.ca" class="email">eliot.mcintire@nrcan-rncan.gc.ca</a> [aut]
<!-- ideally separate authors with new lines, '\n' not working --></p>
<p><strong>This documentation is work in progress. Potential discrepancies and omissions
may exist for the time being. If you find any, contact us using the “Get help”
link above.</strong></p>
</div>
<div id="module-overview-4" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Module Overview<a class="anchor" aria-label="anchor" href="#module-overview-4"><i class="fas fa-link"></i></a>
</h2>
<div id="quick-links-4" class="section level3" number="7.1.1">
<h3>
<span class="header-section-number">7.1.1</span> Quick links<a class="anchor" aria-label="anchor" href="#quick-links-4"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p><a href="landr-biomass_validationknn-module.html#bvalid-general-functioning">General functioning</a></p></li>
<li><p><a href="landr-biomass_validationknn-module.html#bvalid-inputs-list">List of input objects</a></p></li>
<li><p><a href="landr-biomass_validationknn-module.html#bvalid-params-list">List of parameters</a></p></li>
<li><p><a href="landr-biomass_validationknn-module.html#bvalid-outputs-list">List of outputs</a></p></li>
<li><p><a href="landr-biomass_validationknn-module.html#bvalid-sim-flow">Simulation flow and module events</a></p></li>
</ul>
</div>
<div id="summary-3" class="section level3" number="7.1.2">
<h3>
<span class="header-section-number">7.1.2</span> Summary<a class="anchor" aria-label="anchor" href="#summary-3"><i class="fas fa-link"></i></a>
</h3>
<p>LandR <em>Biomass_validationKNN</em> (hereafter <em>Biomass_validationKNN</em>) provides an
approach to validate outputs from LandR Biomass (i.e., <em>Biomass_core</em> linked
with other modules or not) simulations, using publicly available data for
Canadian forests. It produces both a visual and statistical validation of
<em>Biomass_core</em> outputs related to species abundance and presence/absence in the
landscape. To do so, it downloads and prepares all necessary data (observed and
simulated), calculates validation statistics and produces/saves validation
plots.</p>
</div>
<div id="bvalid-links-modules" class="section level3" number="7.1.3">
<h3>
<span class="header-section-number">7.1.3</span> Links to other modules<a class="anchor" aria-label="anchor" href="#bvalid-links-modules"><i class="fas fa-link"></i></a>
</h3>
<p><em>Biomass_validationKNN</em> is intended to be used with <em>Biomass_core</em> and any other
modules that link to it and affect cohort biomass (e.g., disturbance modules and
calibration modules may both affect resulting biomass). See
<a href="https://rpubs.com/PredictiveEcology/LandR_Module_Ecosystem">here</a> for all
available modules in the LandR ecosystem and select <em>Biomass_validationKNN</em> from
the drop-down menu to see potential linkages. By default, disturbed pixels are
excluded from the validation, but the user can bypass this option. The
following is a list of the modules commonly validated with
<em>Biomass_validationKNN</em>.</p>
<ul>
<li>
<a href="https://github.com/PredictiveEcology/Biomass_core"><em>Biomass_core</em></a>: core
forest dynamics simulation module. Used downstream from
<em>Biomass_borealDataPrep</em>;</li>
</ul>
<p><strong>Data and calibration modules:</strong></p>
<ul>
<li><p><a href="https://github.com/PredictiveEcology/Biomass_speciesData"><em>Biomass_speciesData</em></a>:
grabs and merges several sources of species cover data, making species
percent cover (% cover) layers used by other LandR Biomass
modules. Default source data spans the entire Canadian territory;</p></li>
<li><p><a href="https://github.com/PredictiveEcology/Biomass_borealDataPrep"><em>Biomass_borealDataPrep</em></a>:
prepares all parameters and inputs (including initial landscape conditions)
that <em>Biomass_core</em> needs to run a realistic simulation. Default
values/inputs produced are relevant for boreal forests of Western Canada;</p></li>
<li><p><a href="https://github.com/PredictiveEcology/Biomass_speciesParameters"><em>Biomass_speciesParameters</em></a>:
calibrates four-species level traits using permanent sample plot data (i.e.,
repeated tree biomass measurements) across Western Canada.</p></li>
</ul>
<p><strong>Disturbance-related modules:</strong></p>
<ul>
<li><p><a href="https://github.com/PredictiveEcology/Biomass_regeneration"><em>Biomass_regeneration</em></a>:
simulates cohort biomass responses to stand-replacing fires (as in the LANDIS-II
Biomass Succession Extension v.3.2.1),
including cohort mortality and regeneration through resprouting and/or
serotiny;</p></li>
<li><p><a href="https://github.com/PredictiveEcology/Biomass_regenerationPM"><em>Biomass_regenerationPM</em></a>:
like <em>Biomass_regeneration</em>, but allowing partial mortality. Based on the
LANDIS-II Dynamic Fuels &amp; Fire System extension <span class="citation">(<a href="#ref-SturtevantEtAl2018" role="doc-biblioref">Sturtevant <em>et al.</em> 2018</a>)</span>;</p></li>
<li><p><em>fireSense</em>: climate- and land-cover-sensitive fire model simulating fire
ignition, escape and spread processes as a function of climate and
land-cover. Includes built-in parameterisation of these processes using
climate, land-cover, fire occurrence and fire perimeter data. Requires using
<em>Biomass_regeneration</em> or <em>Biomass_regenerationPM</em>. See modules prefixed
“<em>fireSense_</em>” at <a href="https://github.com/PredictiveEcology/" class="uri">https://github.com/PredictiveEcology/</a>;</p></li>
<li><p><a href="https://github.com/PredictiveEcology/LandMine"><em>LandMine</em></a>: wildfire
ignition and cover-sensitive wildfire spread model based on a fire return
interval input. Requires using <em>Biomass_regeneration</em> or
<em>Biomass_regenerationPM</em>;</p></li>
<li><p><a href="https://github.com/PredictiveEcology/scfm"><em>scfm</em></a>: spatially explicit fire
spread module parameterised and modelled as a stochastic three-part process
of ignition, escape, and spread. Requires using <em>Biomass_regeneration</em> or
<em>Biomass_regenerationPM</em>.</p></li>
</ul>
</div>
</div>
<div id="module-manual-4" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Module manual<a class="anchor" aria-label="anchor" href="#module-manual-4"><i class="fas fa-link"></i></a>
</h2>
<div id="bvalid-general-functioning" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> General functioning<a class="anchor" aria-label="anchor" href="#bvalid-general-functioning"><i class="fas fa-link"></i></a>
</h3>
<p><em>Biomass_validationKNN</em> compares simulated outputs of two years (across
replicates), with corresponding years of observed data. It was designed to
compare the observed data for years 2001 (start point for the simulation) and
2011 (i.e., after 10 years of simulation) of the kNN forest layers of the
Canadian National Forest Inventory – these are currently the only available
FAIR datasets <span class="citation">(<em>sensu</em> <a href="#ref-StallEtAl2019" role="doc-biblioref">Stall <em>et al.</em> 2019</a>)</span> on stand biomass and species
% cover changes across Canada. However, the user can supply other
sources of observed data, as long as they have an identical format.</p>
<p>The validation is done both visually (using barplots and boxplots) and using two
statistics: mean absolute deviation of simulated biomass (per species) and the
sum of negative log-likelihoods (SNLL) of predictions with respect to observed
data for species biomass, species presences/absences and changes in biomass
(<span class="math inline">\(\Delta\)</span>B) – the later is still under development.</p>
<p>This module assumes that the simulation data preparation was carried out by
<em>Biomass_borealDataPrep</em>, and so, to ensure that the comparison and the
simulated datasets are built with the same assumptions, the data treatment steps
in <em>Biomass_borealDataPrep</em> are repeated here.</p>
<p>The module may also exclude disturbed pixels identified in <code>rstLCCChange</code> raster
layer and in the fire perimeter data (<code>firePerimeters</code> layer). If this is not
intended, the user can provide a <code>rstLCCChange</code> with <code>NA</code>’s only and/or an empty
<code>firePerimeters</code> <code>sf</code> object.</p>
<p><em>Biomass_validationKNN</em> then compares simulated species biomass, presences,
dominance, and changes in biomass against observed data available for the
starting conditions (2011 by default) and for second time point (e.g. 2011, or
after 10 years of simulation). To do so, for each year and replicate, and for
both the simulated and observed data, the module calculates:</p>
<ul>
<li><p>species relative abundances at the pixel- and landscape-level (across all
pixels);</p></li>
<li><p>species presences and dominance at the landscape level;</p></li>
<li><p>changes in species biomass (<span class="math inline">\(\Delta\)</span>B) at the pixel- and landscape-level for
both the simulated and observed data. Biomass units respect those used in
<em>Biomass_core</em> (<span class="math inline">\(g/m^2\)</span>).</p></li>
</ul>
<p>Pixel-level relative abundances are calculated as the species biomass (summed
across cohorts) divided by the total pixel biomass (summed across cohorts and
species), while landscape-wide relative abundances are calculated as the sum of
a species biomass across all pixels divided by the sum of total biomass across
all pixels.</p>
<p>Species presences are calculated as the number of pixels where a given species
is present, and species dominance is calculated as the number of pixels where a
species has the highest relative biomass in a given pixel. Pixels where two or
more species share the highest biomass value are classified as ‘mixed forest’,
and pixels without any biomass are classified as ‘no veg.’.</p>
<p>Finally, <span class="math inline">\(\Delta\)</span>B is calculated per species as the final biomass (e.g., year
2011) minus the initial biomass (e.g., year 2001), either at the pixel- or
landscape-level.</p>
</div>
<div id="bvalid-valid" class="section level3" number="7.2.2">
<h3>
<span class="header-section-number">7.2.2</span> Validation approaches<a class="anchor" aria-label="anchor" href="#bvalid-valid"><i class="fas fa-link"></i></a>
</h3>
<div id="bvalid-valid-visual" class="section level4" number="7.2.2.1">
<h4>
<span class="header-section-number">7.2.2.1</span> Visual validation<a class="anchor" aria-label="anchor" href="#bvalid-valid-visual"><i class="fas fa-link"></i></a>
</h4>
<p>The module plots the above metrics as barplots showing landscape-level values
(averaged across replicates for the simulated data) or boxplots showing
pixel-level values. Plotting can be live and/or in the form of exported images
(or both turned off completely).</p>
</div>
<div id="bvalid-valid-MAD" class="section level4" number="7.2.2.2">
<h4>
<span class="header-section-number">7.2.2.2</span> Mean absolute deviation<a class="anchor" aria-label="anchor" href="#bvalid-valid-MAD"><i class="fas fa-link"></i></a>
</h4>
<p>Mean absolute deviance (MAD) values are calculated on landscape- and pixel-level
species relative abundances and <span class="math inline">\(\Delta\)</span>B, and landscape-level species presences
and dominance. MAD values are calculated per replicate and year, except <span class="math inline">\(\Delta\)</span>B
MAD values, which integrate across years. Output tables with MAD values are exported as <code>landscapeMAD</code> and
<code>pixelMAD</code>, and the module also produces visual inspection of these values as
dot-and-whisker plots.</p>
</div>
<div id="bvalid-valid-SNLL" class="section level4" number="7.2.2.3">
<h4>
<span class="header-section-number">7.2.2.3</span> Sum of negative log-likelihood (SNLL)<a class="anchor" aria-label="anchor" href="#bvalid-valid-SNLL"><i class="fas fa-link"></i></a>
</h4>
<p>To provide a measure of overall goodness of fit of the model set-up that
gave rise to the outputs, this is the set of starting conditions, parameters and
simulation mechanisms that generated predictions (which includes the LandR
modules used), <em>Biomass_validationKNN</em> estimates sum of negative log-likelihoods
(SNLL) of species presences (at the landscape-level), simulated species biomasses,
and <span class="math inline">\(\Delta\)</span>B (the latter two at the landscape and pixel levels),
with respect to their observed counterparts.</p>
<p>More precisely, let <span class="math inline">\(\ell\)</span> be the log-likelihood function denoting the
probability of observing <span class="math inline">\(x\)</span> of <span class="math inline">\(X\)</span> (a random variable following a continuous
probability distribution <span class="math inline">\(f(x)\)</span>), given a parameter <span class="math inline">\(\theta\)</span>:</p>
<span class="math display" id="eq:loglik">\[\begin{equation}
\ell(\theta \mid x) = f(x)
\tag{7.1}
\end{equation}\]</span>
<p>In our case, <span class="math inline">\(\theta\)</span> is equivalent to the model’s starting conditions and
structure, <span class="math inline">\(X\)</span> is the observed data with <span class="math inline">\(x\)</span> being the simulated values, and
<span class="math inline">\(f(x)\)</span> the continuous probability distribution of <span class="math inline">\(X\)</span>. For each variable that we
wanted to evaluate and for each simulation replicate, Equation <a href="landr-biomass_validationknn-module.html#eq:loglik">(7.1)</a>
is applied to calculate the SNLL estimated for each value of <span class="math inline">\(x\)</span> at the pixel or
landscape-level, <span class="math inline">\(i\)</span>:</p>
<span class="math display" id="eq:negsumloglik">\[\begin{equation}
-\sum_{i = 1}^{N} \ell(\theta \mid x_{i})
\tag{7.2}
\end{equation}\]</span>
<p>where <span class="math inline">\(N\)</span> is equal to total number of pixels. At the landscape scale <span class="math inline">\(N = 1\)</span>.</p>
<p>For species presences and species biomass, we draw the probability of observing
<span class="math inline">\(x_{i}\)</span> (a vector of species presences/biomasses in pixel/landscape <span class="math inline">\(i\)</span>) from a
multinomial density distribution
(<span class="math inline">\(f(x_{i}) = {\sf Multi}(n_{i}, \mathrm{p}_{i})\)</span>), where
<span class="math inline">\(n_{i} = \sum_{j = 1}^{K} X_{i,j}\)</span> (<span class="math inline">\(X\)</span> being the observed values of biomass of
<span class="math inline">\(j = 1, ..., K\)</span> species in a pixel/landscape <span class="math inline">\(i\)</span>) and <span class="math inline">\(\mathrm{p_{i}}\)</span> is the
vector of simulated values <span class="math inline">\(x_{i,j}\)</span>.</p>
<p><strong>The computation of SNLL for <span class="math inline">\(\Delta\)</span>B is still under development</strong>. The
following approach is currently implemented, but presents issues:</p>
<p>For <span class="math inline">\(\Delta\)</span>B, we draw the probability of observing <span class="math inline">\(x_{i,j}\)</span> (the simulated
<span class="math inline">\(\Delta\)</span>B of <span class="math inline">\(j = 1, ..., K\)</span> species in a pixel/landscape <span class="math inline">\(i\)</span>) from a
multivariate Gaussian distribution,
<span class="math inline">\(f(x_{i}) = \mathcal {N}(\mu_{i}, \mathrm{M}_{i})\)</span>, where <span class="math inline">\(\mu_{i}\)</span> is the
vector of observed mean <span class="math inline">\(\Delta\)</span>B for each species <span class="math inline">\(j = 1, ..., K\)</span>, and
<span class="math inline">\(\mathrm{M}\)</span> is the observed <span class="math inline">\(K * K\)</span> variance-covariance matrix of species
<span class="math inline">\(\Delta\)</span>B. Unfortunately this is presenting problems, due to <span class="math inline">\(\mathrm{M}\)</span> not
being strictly positive definite.</p>
<p>After calculating SNLL across pixels (or for the entire landscape), values are
averaged across replicates for an overall model estimate and exported in the
<code>logLikelihood</code> table.</p>
<p>We refer to the Wikipedia pages on the <a href="https://en.wikipedia.org/wiki/Multinomial_distribution">multinomial
distribution</a> and on the
<a href="https://en.wikipedia.org/wiki/Multivariate_normal_distribution#Density_function">multivariate Gaussian
distribution</a>
for a good summary of these two distributions and their use in SNLL estimation.</p>
</div>
</div>
<div id="bvalid-inputs-list" class="section level3" number="7.2.3">
<h3>
<span class="header-section-number">7.2.3</span> List of input objects<a class="anchor" aria-label="anchor" href="#bvalid-inputs-list"><i class="fas fa-link"></i></a>
</h3>
<p>The full list of input objects <em>Biomass_validationKNN</em> requires is presented
below (Table <a href="landr-biomass_validationknn-module.html#tab:moduleInputs2-Biomass-validationKNN">7.1</a>). All have defaults
except <code>studyArea</code>, which <strong>must</strong> be provided by the user, or another module.</p>
<p>Of these, the input spatial layers land-cover change (change type and year),
fire perimeters, % species cover, stand age and stand biomass are
obtained from National Forest Inventory kNN layers for years 2001 and 2011.</p>
<p>We strongly recommend that for the “starting point layers” (those suffixed with
<code>*Start</code>, which by default correspond to 2001) the user supplies the same
objects used as the starting input layers to initialise the simulation to make
sure that they match.</p>
<p>Note that objects suffixed with <code>*Start</code> correspond to the same objects in the
main simulation without this suffix (e.g. <code>rawBiomassMapStart</code> is
<code>rawBiomassMap</code> in <em>Biomass_borealDataPrep</em>), whereas other objects like
<code>studyArea</code> and <code>rasterToMatch</code> have the same names in the simulation and should
be <strong>exactly</strong> the same object.</p>
<p>Of the inputs in Table <a href="landr-biomass_validationknn-module.html#tab:moduleInputs2-Biomass-validationKNN">7.1</a>, the
following deserve special attention:</p>
<p><strong>Spatial layers</strong></p>
<ul>
<li><p><code>biomassMap</code> – a map of simulated stand biomass (in <span class="math inline">\(g/m^2\)</span> ) filtered for
the pixels where cohort dynamics were simulated. This corresponds to the
<code>sim$biomassMap</code> object produced by <em>Biomass_borealDataPrep</em> or to the
<code>sim$simulatedBiomassMap</code> produced by <em>Biomass_core</em>.</p></li>
<li><p><code>firePerimeters</code> – a fire perimeters polygon map that should be used to
exclude recently burned pixels from the analysis. If this is not desired the
user needs to provide an empty <code>sf</code> object (e.g., <code><a href="https://r-spatial.github.io/sf/reference/st.html">sf::st_polygon()</a></code>) .</p></li>
<li><p><code>rawBiomassMapStart</code> – raw biomass data used to initialise and parametrise
<code>Biomass_core</code>. By default, the module uses the stand biomass map from kNN
for the year 2001. The user must make sure this appropriate for their use
case, or else supply the correct raster layer.</p></li>
<li><p><code>rawBiomassMapEnd</code> – raw biomass data used to validate the model after
several simulation years. By default, the module uses the kNN stand biomass map
from 2011, which is compared with the 10th year of a simulation initialised
using the kNN 2001 data. The user must make sure this
appropriate for their use case, or else supply the correct raster layer.</p></li>
<li><p><code>rstLCChange</code> – a binary raster layer with disturbed pixels that should be
removed from the analyses. Can be combined with <code>rstLCChangeYr</code> to filter
pixels disturbed in a given time period defined by <code>P(sim)$LCChangeYr</code>.
Defaults to <a href="https://opendata.nfis.org/downloads/forest_change/C2C_change_type_1985_2011.zip">Canada’s forest change national map between 1985-2011
(CFS)</a>.</p></li>
<li><p><code>rstLCChangeYr</code> – a raster layer with year of disturbance. This is an
optional layer that can be combined with <code>rstLCChange</code> and
<code>P(sim)$LCChangeYr</code> to filter disturbed pixels by year of disturbance. Not
used by default. Defaults to <a href="https://opendata.nfis.org/downloads/forest_change/C2C_change_year_1985_2011.zip">Canada’s forest change year national map
between 1985-2011
(CFS)</a>.</p></li>
<li><p><code>speciesLayersStart</code> – same as <code>rawBiomassMapStart</code>, but with respect to
species % cover data.</p></li>
<li><p><code>speciesLayersEnd</code> – same as <code>rawBiomassMapEnd</code>, but with respect to
species % cover data.</p></li>
<li><p><code>studyArea</code> – shapefile. A <code>SpatialPolygonsDataFrame</code> with a single polygon
determining the where the simulation will take place. This is the only input
object that <strong>must be supplied by the user</strong>.</p></li>
</ul>
<p><strong>Simulation-related objects</strong></p>
<ul>
<li><p><code>allCohortData</code> – OPTIONAL. A <code>data.table</code> containing all <code>cohortData</code>
objects relevant for the validation (e.g., as many <code>cohortData</code> objects as
simulation replicates times 2, for the beginning and end year). If not
supplied, <em>Biomass_validationKNN</em> attempts to produce this object using the
<code>cohortData</code> object file listed in <code>simulationOutputs</code> . Hence, the user
must either supply <em>both</em> <code>allCohortData</code> and <code>pixelGroupMapStk</code> <em>or</em>
<code>simulationOutputs.</code></p></li>
<li><p><code>pixelGroupMapStk</code> – OPTIONAL. As <code>allCohortData</code>, but with respect to
<code>pixelGroupMap</code> objects.</p></li>
<li><p><code>simulationOutputs</code> – OPTIONAL. A <code>data.frame</code> that has the same structure
as the <code>data.frame</code>’s specifying outputs to be saved in
<code>spades(..., outputs = data.frame(...))</code>. We advise passing the same
<code>data.frame</code> that was supplied to <code>spades</code> during the simulation call, but
filtered by the relevant <code>cohortData</code> and <code>pixelGroupMap</code> objects and,
potentially, with file paths corrected to match the current working
directory (see <a href="landr-biomass_validationknn-module.html#bvalid-example">Usage example</a>). Only used if
<code>allCohortData</code> and <code>pixelGroupMapStk</code> are not supplied.</p></li>
<li><p><code>pixelGroupMap</code> – a raster layer with <em>pixelGroup</em> IDs per pixel. Pixels
are grouped based on identical <em>ecoregionGroup</em>, <em>speciesCode</em>, <em>age</em>
and <em>B</em> composition, even if the user supplies other initial groupings
(e.g., this is possible in the <em>Biomass_borealDataPrep</em> data module).</p></li>
</ul>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:moduleInputs2-Biomass-validationKNN">Table 7.1: </span>List of <em>Biomass_validationKNN</em> input objects and their description.</caption>
<colgroup>
<col width="2%">
<col width="2%">
<col width="69%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th align="left">objectName</th>
<th align="left">objectClass</th>
<th align="left">desc</th>
<th align="left">sourceURL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">allCohortData</td>
<td align="left">data.table</td>
<td align="left">All <code>cohortData</code> tables saved during the simulation, particularly for the validation years. If not supplied, the module will attempt to retrieve them using the ‘simulationOutputs’ table</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">biomassMap</td>
<td align="left">RasterLayer</td>
<td align="left">total biomass raster layer in study area (in g/m^2), filtered for pixels covered by <code>cohortData</code>. Only used to calculate total no. of pixels being simulated If not supplied, will default to <code>rawBiomassMapStart</code>
</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">firePerimeters</td>
<td align="left">sf</td>
<td align="left">A map of fire perimeters in the study area that can be used to exclude pixels that have been burnt during the validation period. If burnt pixels are not to be excluded Provide an empty <code>sf</code> object with the same properties as the default. Defaults to the latest Canadian Wildland Fire Information System National Burned Area Composite, subset to fires occuring up to last validation year (inclusively). Source URL determined by <code>fireURL</code>
</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">fireURL</td>
<td align="left">character</td>
<td align="left">A URL to a fire database, such as the Canadian National Fire Database, that is a zipped shapefile with fire polygons, an attribute (i.e., a column) named ‘Year’. If supplied (omitted with NULL or NA), this will be used to ‘update’ age pixels on <code>standAgeMap</code> with ‘time since fire’ as derived from this fire polygons map</td>
<td align="left"><a href="https://cwfis.cfs.nrcan.gc.ca/downloads/nfdb/fire_poly/current_version/NFDB_poly.zip" class="uri">https://cwfis.cfs.nrcan.gc.ca/downloads/nfdb/fire_poly/current_version/NFDB_poly.zip</a></td>
</tr>
<tr class="odd">
<td align="left">pixelGroupMapStk</td>
<td align="left">RasterStack</td>
<td align="left">A stack of <code>pixelGroupMap</code>s saved during the simulation, particularly for the validation years. If not supplied, the module will attempt to make it using the ‘simulationOutputs’ table</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">rawBiomassMapStart</td>
<td align="left">RasterLayer</td>
<td align="left">observed total biomass raster layer in study area at the first year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived total aboveground biomass map from 2001 (in ton/ha). See <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a> for metadata.</td>
<td align="left"><a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/NFI_MODIS250m_2001_kNN_Structure_Biomass_TotalLiveAboveGround_v1.tif" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/NFI_MODIS250m_2001_kNN_Structure_Biomass_TotalLiveAboveGround_v1.tif</a></td>
</tr>
<tr class="odd">
<td align="left">rawBiomassMapEnd</td>
<td align="left">RasterLayer</td>
<td align="left">observed total biomass raster layer in study area at the last year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived total aboveground biomass map from 2011 (in ton/ha) See <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a>
</td>
<td align="left"><a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/NFI_MODIS250m_2011_kNN_Structure_Biomass_TotalLiveAboveGround_v1.tif" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/NFI_MODIS250m_2011_kNN_Structure_Biomass_TotalLiveAboveGround_v1.tif</a></td>
</tr>
<tr class="even">
<td align="left">rasterToMatch</td>
<td align="left">RasterLayer</td>
<td align="left">A raster of the <code>studyArea</code> in the same resolution and projection as <code>rawBiomassMapStart</code>. This is the scale used for all outputs for use in the simulation.</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">rstLCChange</td>
<td align="left">RasterLayer</td>
<td align="left">A mask-type map of land cover changes in the study area that can be used to exclude pixels that have been disturbed during the validation period. If disturbed pixels are not to be excluded Provide an empty sf object with the same properties as the default. Defaults to Canada’s forest change map between 1985-2011 (CFS), filtered for years 2001-2011 (inclusively) and all disturbances collapsed (map only has values of 1 and NA). See <code>P(sim)$LCChangeYr</code> parameter to change the period of disturbances, and <a href="https://opendata.nfis.org/mapserver/nfis-change_eng.html" class="uri">https://opendata.nfis.org/mapserver/nfis-change_eng.html</a> for more information.</td>
<td align="left"><a href="https://opendata.nfis.org/downloads/forest_change/C2C_change_type_1985_2011.zip" class="uri">https://opendata.nfis.org/downloads/forest_change/C2C_change_type_1985_2011.zip</a></td>
</tr>
<tr class="even">
<td align="left">rstLCChangeYr</td>
<td align="left">RasterLayer</td>
<td align="left">An OPTIONAL map of land cover change years in the study area used to exclude pixels that have been disturbed during the validation period. It defaults to Canada’s forest change year national map between 1985-2011 (CFS). If <code>P(sim)$LCChangeYr</code> is not <code>NULL</code>, this layer is used to filted disturbed pixels that fall within the years specified by <code>P(sim)$LCChangeYr</code>. If <code>P(sim)$LCChangeYr</code> is <code>NULL</code> this layer is not used. See <a href="https://opendata.nfis.org/mapserver/nfis-change_eng.html" class="uri">https://opendata.nfis.org/mapserver/nfis-change_eng.html</a> for more information.</td>
<td align="left"><a href="https://opendata.nfis.org/downloads/forest_change/C2C_change_year_1985_2011.zip" class="uri">https://opendata.nfis.org/downloads/forest_change/C2C_change_year_1985_2011.zip</a></td>
</tr>
<tr class="odd">
<td align="left">simulationOutputs</td>
<td align="left">data.table</td>
<td align="left">An OPTIONAL table listing simulation outputs (as passed to <code><a href="https://spades-core.predictiveecology.org/reference/spades.html">spades()</a></code>, or <code>experiment</code>) that will be used to make <code>allCohortData</code>, <code>pixelGroupMapStk</code>, if these are not provided.</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">speciesLayersStart</td>
<td align="left">RasterStack</td>
<td align="left">observed cover percentage raster layers by species in Canada species map, at the first year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived species cover maps from 2001, using a cover threshold of 10% - see <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a> for metadata</td>
<td align="left"><a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/</a></td>
</tr>
<tr class="odd">
<td align="left">speciesLayersEnd</td>
<td align="left">RasterStack</td>
<td align="left">observed percent cover raster layers by species in Canada used for validation at the last year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived species cover maps from 2011 - see <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a> for metadata</td>
<td align="left"><a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/</a></td>
</tr>
<tr class="even">
<td align="left">sppColorVect</td>
<td align="left">character</td>
<td align="left">A named vector of colors to use for plotting. The names must be in sim<span class="math inline">\(sppEquiv[[sim\)</span>sppEquivCol]], and should also contain a color for ‘Mixed’</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">sppEquiv</td>
<td align="left">data.table</td>
<td align="left">table of species equivalencies. See <code><a href="https://landr.predictiveecology.org/reference/sppEquivalencies_CA.html">LandR::sppEquivalencies_CA</a></code>.</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">standAgeMapStart</td>
<td align="left">RasterLayer</td>
<td align="left">observed stand age map in study area, at the first year of the validation period Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived biomass map from 2001 - see <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a> for metadata</td>
<td align="left"><a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/NFI_MODIS250m_2001_kNN_Structure_Stand_Age_v1.tif" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/NFI_MODIS250m_2001_kNN_Structure_Stand_Age_v1.tif</a></td>
</tr>
<tr class="odd">
<td align="left">standAgeMapEnd</td>
<td align="left">RasterLayer</td>
<td align="left">observed stand age raster layer in study area, at the last year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived stand age map from 2011. See <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a>
</td>
<td align="left"><a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/NFI_MODIS250m_2011_kNN_Structure_Stand_Age_v1.tif" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/NFI_MODIS250m_2011_kNN_Structure_Stand_Age_v1.tif</a></td>
</tr>
<tr class="even">
<td align="left">studyArea</td>
<td align="left">SpatialPolygonsDataFrame</td>
<td align="left">Polygon to use as the study area. Must be provided by the user</td>
<td align="left">NA</td>
</tr>
</tbody>
</table></div>
</div>
<div id="bvalid-params-list" class="section level3" number="7.2.4">
<h3>
<span class="header-section-number">7.2.4</span> List of parameters<a class="anchor" aria-label="anchor" href="#bvalid-params-list"><i class="fas fa-link"></i></a>
</h3>
<p>Table <a href="landr-biomass_validationknn-module.html#tab:moduleParams2-Biomass-validationKNN">7.2</a> lists all parameters used
in <em>Biomass_validationKNN</em> and their detailed information. All have default
values specified in the module’s metadata</p>
<p>Of the parameters listed in Table
<a href="landr-biomass_validationknn-module.html#tab:moduleParams2-Biomass-validationKNN">7.2</a>, the following are particularly
important:</p>
<ul>
<li><p><code>LCChangeYr</code> – integer. Optional parameter defining the years of
disturbance that should be filtered out of the analysis using the
<code>rstLCChangeYr</code> layer. This parameter is set to <code>NULL</code> by default, meaning
that <code>rstLCChangeYr</code> will not be used.</p></li>
<li><p><code>sppEquivCol</code> – character. the column name in <code>speciesEquivalency</code>
data.table that defines the naming convention to use throughout the
simulation.</p></li>
<li><p><code>validationReps</code> – integer. which simulation replicates should be used for
the validation.</p></li>
<li><p><code>validationYears</code> – integer. What simulation years should be used for the
validation - the year number needs to match the observed data year. For
instance, if the first observed data year is 2001, that must be the first
simulation year.</p></li>
</ul>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:moduleParams2-Biomass-validationKNN">Table 7.2: </span>List of <em>Biomass_validationKNN</em> parameters and their description.</caption>
<colgroup>
<col width="4%">
<col width="1%">
<col width="2%">
<col width="0%">
<col width="0%">
<col width="89%">
</colgroup>
<thead><tr class="header">
<th align="left">paramName</th>
<th align="left">paramClass</th>
<th align="left">default</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">paramDesc</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">coverThresh</td>
<td align="left">integer</td>
<td align="left">10</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">The minimum % cover a species needs to have (per pixel) in the study area to be considered present. Should be the same as the one used to obtain the species cover layers for simulation set up.</td>
</tr>
<tr class="even">
<td align="left">deciduousCoverDiscount</td>
<td align="left">numeric</td>
<td align="left">0.8418911</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">This was estimated with data from NWT on March 18, 2020 and may or may not be universal. Should be the same as the one used when preparing <code>cohortData</code> in the simulation set up.</td>
</tr>
<tr class="odd">
<td align="left">LCChangeYr</td>
<td align="left">integer</td>
<td align="left"></td>
<td align="left">1900</td>
<td align="left">NA</td>
<td align="left">OPTIONAL. An integer or vector of integers of the validation period years, defining which years of land-cover changes (i.e. disturbances) should be excluded. <code>NULL</code> by default, which presumes no subsetting based on years is done internally (either the user supplies a pre-filtered <code>rstLCChange</code>, or no filtering is desired). If not <code>NULL</code> <code>rstLCChangeYr</code> is used to filter disturbed pixels within the specified years. See <a href="https://opendata.nfis.org/mapserver/nfis-change_eng.html" class="uri">https://opendata.nfis.org/mapserver/nfis-change_eng.html</a> for more information.</td>
</tr>
<tr class="even">
<td align="left">minCoverThreshold</td>
<td align="left">numeric</td>
<td align="left">5</td>
<td align="left">0</td>
<td align="left">100</td>
<td align="left">Cover that is equal to or below this number will be omitted from the dataset Should be the same as the one used when preparing <code>cohortData</code> in the simulation set up.</td>
</tr>
<tr class="odd">
<td align="left">obsDeltaAgeB</td>
<td align="left">logical</td>
<td align="left">TRUE</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">When TRUE, the observed changes in biomass and age (deltaB, deltaAge) between the two validation years will be plotted as maps and scatterplots</td>
</tr>
<tr class="even">
<td align="left">pixelGroupBiomassClass</td>
<td align="left">numeric</td>
<td align="left">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">When assigning <code>pixelGroup</code> membership, this defines the resolution of biomass that will be considered ‘the same pixelGroup’, e.g., if it is 100, then 5160 and 5240 will be the same Should be the same as the one used when preparing <code>cohortData</code> in the simulation set up.</td>
</tr>
<tr class="odd">
<td align="left">sppEquivCol</td>
<td align="left">character</td>
<td align="left">Boreal</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">The column in <code>sim$sppEquiv</code> data.table to use as a naming convention</td>
</tr>
<tr class="even">
<td align="left">validationReps</td>
<td align="left">integer</td>
<td align="left">1, 2, 3,….</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">The simulation repetitions for the validation. Defaults to 1:10. Set to NA if not using repetitions (i.e. only one run)</td>
</tr>
<tr class="odd">
<td align="left">validationYears</td>
<td align="left">integer</td>
<td align="left">2001, 2011</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">The simulation years for the validation. Defaults to 2001 and 2011. Must select two years</td>
</tr>
<tr class="even">
<td align="left">.plotInitialTime</td>
<td align="left">integer</td>
<td align="left">1</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">If NA plotting is off completely (this includes saving).</td>
</tr>
<tr class="odd">
<td align="left">.plots</td>
<td align="left">character</td>
<td align="left">object, png</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Passed to <code>types</code> in Plots (see ?Plots). There are a few plots that are made within this module, if set. Note that plots (or their data) are saved in file.path(outputPath(sim), ‘figures’). If <code>NA</code>, plotting is off completely (this includes plot saving).</td>
</tr>
<tr class="even">
<td align="left">.saveInitialTime</td>
<td align="left">numeric</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">This describes the simulation time at which the first save event should occur</td>
</tr>
<tr class="odd">
<td align="left">.saveInterval</td>
<td align="left">numeric</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">This describes the simulation time interval between save events</td>
</tr>
<tr class="even">
<td align="left">.studyAreaName</td>
<td align="left">character</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Human-readable name for the study area used. If <code>NA</code>, a hash of <code>studyArea</code> will be used.</td>
</tr>
<tr class="odd">
<td align="left">.useCache</td>
<td align="left">logical</td>
<td align="left">init</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Controls cache; caches the init event by default</td>
</tr>
</tbody>
</table></div>
</div>
<div id="bvalid-outputs-list" class="section level3" number="7.2.5">
<h3>
<span class="header-section-number">7.2.5</span> List of outputs<a class="anchor" aria-label="anchor" href="#bvalid-outputs-list"><i class="fas fa-link"></i></a>
</h3>
<p>The module produces the following outputs (Table
<a href="landr-biomass_validationknn-module.html#tab:moduleOutputs-Biomass-validationKNN">7.3</a>):</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:moduleOutputs-Biomass-validationKNN">Table 7.3: </span>List of <em>Biomass_validationKNN</em> output objects and their description.</caption>
<colgroup>
<col width="2%">
<col width="1%">
<col width="95%">
</colgroup>
<thead><tr class="header">
<th align="left">objectName</th>
<th align="left">objectClass</th>
<th align="left">desc</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">logLikelihood</td>
<td align="left">data.table</td>
<td align="left">A table of negative sum log-likelihood values calculated for different variables and averaged across repetitions. At the moment, log-likelihood values are calculated for biomass (landscape- and pixel-level), species presences and dominance (lanscape-level) and deltaB (landscape- and pixel-level. For biomass and count data (presences/dominance, we assume an underlying multinomial distribution, and for deltaB a multivariate Gaussian distribution - note that the later is still under development.</td>
</tr>
<tr class="even">
<td align="left">landscapeMAD</td>
<td align="left">data.table</td>
<td align="left">Mean absolute deviance values calculated on landscape-level relative abundances, species presences and dominance, and deltaB, per repetition and year (except for deltaB, which is integrated across years)</td>
</tr>
<tr class="odd">
<td align="left">landscapeVars</td>
<td align="left">data.table</td>
<td align="left">A table containing observed and simulated landscape-averaged variables used for validation (by year and repetition, ‘rep’, in the case of simulated data), namely: species relative abundances (‘relAbund’), species presenses (‘count’), species dominance (as in no. pixels where a given species, has higher ‘relAbund’; ‘countDom’) and species changes in biomass, as 2011 minus 2001 (‘deltaB’). Observed data rows are labelled as ‘observed’ in ‘dataType’ column. In species dominance, pixels with &gt;= 2 species with max(B) and pixels with no B are classified as ‘Mixed’ and ‘No veg.’, respectively in the ‘speciesCode’ column - note that this is ‘vegType’ column in <code>pixelCohortData</code>.</td>
</tr>
<tr class="even">
<td align="left">pixelCohortData</td>
<td align="left">data.table</td>
<td align="left">A table containing observed and simulated pixel-level data (by year and repetition, ‘rep’, in the case of simulated data) on species biomass (summed across cohorts, ‘B’), total pixel biomass (‘pixelB’), average biomass-weighted pixel age (‘pixelAge’), species relative abundance (calculated as B/pixelB, ‘relativeAbund’), species dominance (the species with max(B), ‘vegType’), and lanscape-wide biomass (‘landscapeB’). Observed data columns are suffixed with ‘Obsrvd’. In species dominance, pixels with &gt;= 2 species with max(B) (i.e. ‘noDoms’ &gt;= 2) are classified as ‘Mixed’.</td>
</tr>
<tr class="odd">
<td align="left">pixelMAD</td>
<td align="left">data.table</td>
<td align="left">Mean absolute deviance values calculated on pixel-level relative abundances and deltaB, per repetition and year (except for deltaB, which is integrated across years)</td>
</tr>
<tr class="even">
<td align="left">pixelVars</td>
<td align="left">data.table</td>
<td align="left">The same as <code>landscapeVars</code>, but variables are calculated at the pixel-level</td>
</tr>
<tr class="odd">
<td align="left">rstDisturbedPix</td>
<td align="left">RasterLayer</td>
<td align="left">Raster of pixel IDs (as a mask) that have been disturbed by fire or suffered land-cover changes during the validation period. These pixels are excluded form the validation.</td>
</tr>
<tr class="even">
<td align="left">rawBiomassMapStart</td>
<td align="left">RasterLayer</td>
<td align="left">observed total biomass raster layer in study area at the first year of the validation period. Filtered to exclude pixels that were disturbed during the validation period</td>
</tr>
<tr class="odd">
<td align="left">rawBiomassMapEnd</td>
<td align="left">RasterLayer</td>
<td align="left">observed total biomass raster layer in study area at the last year of the validation period. Filtered to exclude pixels that were disturbed during the validation period</td>
</tr>
<tr class="even">
<td align="left">speciesLayersStart</td>
<td align="left">RasterStack</td>
<td align="left">observed percent cover raster layers by species in Canada at the first year of the validation period. Filtered to exclude pixels that were disturbed during the validation period</td>
</tr>
<tr class="odd">
<td align="left">speciesLayersEnd</td>
<td align="left">RasterStack</td>
<td align="left">observed percent cover raster layers by species in Canada at the last year of the validation period. Filtered to exclude pixels that were disturbed during the validation period</td>
</tr>
<tr class="even">
<td align="left">standAgeMapStart</td>
<td align="left">RasterLayer</td>
<td align="left">observed stand age map in study area, at the first year of the validation period Filtered to exclude pixels that were disturbed during the validation period</td>
</tr>
<tr class="odd">
<td align="left">standAgeMapEnd</td>
<td align="left">RasterLayer</td>
<td align="left">observed stand age map in study area, at the last year of the validation period Filtered to exclude pixels that were disturbed during the validation period</td>
</tr>
</tbody>
</table></div>
</div>
<div id="bvalid-sim-flow" class="section level3" number="7.2.6">
<h3>
<span class="header-section-number">7.2.6</span> Simulation flow and module events<a class="anchor" aria-label="anchor" href="#bvalid-sim-flow"><i class="fas fa-link"></i></a>
</h3>
<p><em>Biomass_validationKNN</em> initialises itself and prepares all inputs provided that
it has access to outputs of simulations from <em>Biomass_core</em>, and internet access
to retrieve the observed kNN datasets used for
validation<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>.</p>
<p>The module then compiles all simulation output data provided that the user
supplies the object names and their file paths via the <code>simulationOutputs</code> input
object. Alternatively, the user may pass the pre-compiled outputs (namely the
<code>cohortData</code> and <code>pixelGroupMap</code> objects) via the <code>allCohortData</code> and
<code>pixelGroupMapStk</code> input objects. See <a href="landr-biomass_validationknn-module.html#bvalid-inputs-list">list of input
objects</a> for more detail.</p>
<p>Future users should run <em>Biomass_validationKNN</em> with defaults and inspect what
the objects are like before supplying their own data, or alternative data URLs.
Alternatively, users may develop their own validation modules using
<em>Biomass_validationKNN</em> as a template. We expect the number of validation
modules to increase as other validation approaches are developed based on
project needs.</p>
<p>The general flow of <em>Biomass_validationKNN</em> processes is (note that this module
only runs once, i.e. in one “time step”):</p>
<ol style="list-style-type: decimal">
<li><p>Preparation of all necessary objects, namely obtaining the observed data
layers from on-line repositories (or if available stored local copies) and
the compiling simulated data if the user has not done so previously (see
<a href="landr-biomass_validationknn-module.html#bvalid-inputs-list">list of input objects</a>) – (<code>init</code> event).</p></li>
<li><p>Calculation of summary variables for validation (<code>calculateValidVars</code>
event), namely :</p></li>
</ol>
<ul>
<li><p>relative biomass per species per pixel and across the landscape (per year
and per replicate)</p></li>
<li><p>changes in species biomass per pixel and across the landscape (per
replicate), with respect to the first year.</p></li>
<li><p>species dominance across the landscape</p></li>
<li><p>species presences across the landscape</p></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>Calculation of validation statistics (<code>validationStats</code> event), namely mean
absolute deviations (MAD) and sum of negative log-likelihoods (SNLL).</p></li>
<li><p>Assessment of the relationship between observed <span class="math inline">\(\Delta\)</span>B and observed
<span class="math inline">\(\Delta\)</span>Age (<code>obsDeltaMaps</code> event) – this is an optional visual diagnostic
of the observed data that produces scatterplots of <span class="math inline">\(\Delta\)</span>B ~ <span class="math inline">\(\Delta\)</span>Age
of three types:</p></li>
</ol>
<ul>
<li><p>With raw observed values of <span class="math inline">\(\Delta\)</span>B and <span class="math inline">\(\Delta\)</span>Age</p></li>
<li><p>With <span class="math inline">\(\Delta\)</span>B and <span class="math inline">\(\Delta\)</span>Age calculated on observed data <em>after</em>
pre-processing (i.e., the data clean-steps done in <code>Biomass_borealDataPrep</code>,
which are also done to the observed data before validation)</p></li>
<li><p>With the data shown in 2) above, but filtered by pixels where there was only
a stand age increment corresponding to the number of years of between the
two validation time points. This is not necessarily a <em>correct</em> filter, as
stands may have suffered an age reduction due to the loss of old cohorts
from background mortality (i.e., not coming from disturbances. However, if
using the default input datasets, it is unlikely that this is a widespread
phenomenon in only 10 years. We remind the user that disturbed pixels should
be removed from the analyses when validating succession dynamics in the
absence of disturbance - the default option.</p></li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Plots (<code>landscapeWidePlots</code>, <code>pixelLevelPlots</code> and <code>deltaBComparisons</code>
events):</li>
</ol>
<ul>
<li><p>Barplots of landscape-wide and pixel-level comparisons between observed and
simulated data, with respect to relative biomass, dominance and presences.</p></li>
<li><p>Boxplots of biomass changes (<span class="math inline">\(\Delta\)</span>B) in observed and simulated data, with
respect to the first year.</p></li>
<li><p>Maps of biomass and age changes (<span class="math inline">\(\Delta\)</span>B, <span class="math inline">\(\Delta\)</span>Age) with respect to the
first year, in observed and simulated data.</p></li>
</ul>
<p>All module default outputs are in the form of plots, but the user can chose to
save any objects (see Table <a href="landr-biomass_validationknn-module.html#tab:moduleOutputs-Biomass-validationKNN">7.3</a>).</p>
</div>
</div>
<div id="bvalid-example" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Usage example<a class="anchor" aria-label="anchor" href="#bvalid-example"><i class="fas fa-link"></i></a>
</h2>
<div id="load-spades-and-other-packages.-2" class="section level3" number="7.3.1">
<h3>
<span class="header-section-number">7.3.1</span> Load <code>SpaDES</code> and other packages.<a class="anchor" aria-label="anchor" href="#load-spades-and-other-packages.-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://spades.predictiveecology.org">SpaDES</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://spades-install.predictiveecology.org/">SpaDES.install</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://spades-experiment.predictiveecology.org/">SpaDES.experiment</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org">future</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="get-the-modules" class="section level3" number="7.3.2">
<h3>
<span class="header-section-number">7.3.2</span> Get the modules<a class="anchor" aria-label="anchor" href="#get-the-modules"><i class="fas fa-link"></i></a>
</h3>
<p>Because <em>Biomass_validationKNN</em> is meant to validate simulation outputs against
observed data, we need to first run a simulation of forest dynamics with
<em>Biomass_core</em>. To do that we get both modules’ code from the PredictiveEcology
GitHub repository. Notice that we are placing all module code, inputs and
outputs in temporary directories.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tempDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>inputPath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>, <span class="st">"inputs"</span><span class="op">)</span>, cachePath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>,
    <span class="st">"cache"</span><span class="op">)</span>, modulePath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>, <span class="st">"modules"</span><span class="op">)</span>, outputPath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>,
    <span class="st">"outputs"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/SpaDES.install/man/getModule.html">getModule</a></span><span class="op">(</span><span class="st">"PredictiveEcology/Biomass_core"</span>, modulePath <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">modulePath</span>,
    overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/SpaDES.install/man/getModule.html">getModule</a></span><span class="op">(</span><span class="st">"PredictiveEcology/Biomass_validationKNN"</span>, modulePath <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">modulePath</span>,
    overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## by default the repository branch name is appended to the</span>
<span class="co">## module folder name.  so we change the folder name to</span>
<span class="co">## remove the '-master' suffix.</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">modulePath</span>, <span class="st">"Biomass_core-master"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">modulePath</span>, <span class="st">"Biomass_validationKNN-master"</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">modulePath</span>, <span class="st">"Biomass_core"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">modulePath</span>,
        <span class="st">"Biomass_validationKNN"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="setup-simulation-2" class="section level3" number="7.3.3">
<h3>
<span class="header-section-number">7.3.3</span> Setup simulation<a class="anchor" aria-label="anchor" href="#setup-simulation-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">2001</span>, end <span class="op">=</span> <span class="fl">2011</span><span class="op">)</span>

<span class="va">studyArea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://reproducible.predictiveecology.org/reference/Cache.html">Cache</a></span><span class="op">(</span><span class="va">randomStudyArea</span>, size <span class="op">=</span> <span class="fl">1e+07</span><span class="op">)</span>  <span class="co"># cache this so it creates a random one only once on a machine</span>

<span class="co"># Pick the species you want to work with -- using the</span>
<span class="co"># naming convention in 'Boreal' column of</span>
<span class="co"># LandR::sppEquivalencies_CA</span>
<span class="va">speciesNameConvention</span> <span class="op">&lt;-</span> <span class="st">"Boreal"</span>
<span class="va">speciesToUse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pice_Gla"</span>, <span class="st">"Popu_Tre"</span>, <span class="st">"Pinu_Con"</span><span class="op">)</span>

<span class="va">sppEquiv</span> <span class="op">&lt;-</span> <span class="fu">LandR</span><span class="fu">::</span><span class="va"><a href="https://landr.predictiveecology.org/reference/sppEquivalencies_CA.html">sppEquivalencies_CA</a></span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">speciesNameConvention</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span>
    <span class="va">speciesToUse</span><span class="op">]</span>
<span class="co"># Assign a colour convention for graphics for each species</span>
<span class="va">sppColorVect</span> <span class="op">&lt;-</span> <span class="fu">LandR</span><span class="fu">::</span><span class="fu"><a href="https://landr.predictiveecology.org/reference/sppColors.html">sppColors</a></span><span class="op">(</span><span class="va">sppEquiv</span>, <span class="va">speciesNameConvention</span>,
    newVals <span class="op">=</span> <span class="st">"Mixed"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span>

<span class="co">## Usage example</span>
<span class="va">modules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="st">"Biomass_core"</span><span class="op">)</span>
<span class="va">objects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>studyArea <span class="op">=</span> <span class="va">studyArea</span>, sppEquiv <span class="op">=</span> <span class="va">sppEquiv</span>, sppColorVect <span class="op">=</span> <span class="va">sppColorVect</span><span class="op">)</span>

<span class="va">successionTimestep</span> <span class="op">&lt;-</span> <span class="fl">20L</span>

<span class="co">## keep default values for most parameters (ommitted from</span>
<span class="co">## this list)</span>
<span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Biomass_core <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sppEquivCol <span class="op">=</span> <span class="va">speciesNameConvention</span>,
    successionTimestep <span class="op">=</span> <span class="va">successionTimestep</span>, .plotInitialTime <span class="op">=</span> <span class="va">times</span><span class="op">$</span><span class="va">start</span>,
    .plotInterval <span class="op">=</span> <span class="fl">1L</span>, .plots <span class="op">=</span> <span class="st">"png"</span>, .saveInitialTime <span class="op">=</span> <span class="va">times</span><span class="op">$</span><span class="va">start</span>,
    .useCache <span class="op">=</span> <span class="st">"init"</span>, .useParallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>

<span class="va">outputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>objectName <span class="op">=</span> <span class="st">"cohortData"</span>,
    saveTime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">times</span><span class="op">$</span><span class="va">start</span>, <span class="va">times</span><span class="op">$</span><span class="va">end</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, eventPriority <span class="op">=</span> <span class="fl">1</span>,
    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">outputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">outputs</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>objectName <span class="op">=</span> <span class="st">"pixelGroupMap"</span>,
    saveTime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">times</span><span class="op">$</span><span class="va">start</span>, <span class="va">times</span><span class="op">$</span><span class="va">end</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, eventPriority <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="run-simulation" class="section level3" number="7.3.4">
<h3>
<span class="header-section-number">7.3.4</span> Run simulation<a class="anchor" aria-label="anchor" href="#run-simulation"><i class="fas fa-link"></i></a>
</h3>
<p>Here we run a simulation with three replicates using the <code>experiment2</code> function
of the <code>SpaDES.experiment</code> R package <span class="citation">(<a href="#ref-McIntireChubaty2021" role="doc-biblioref">McIntire &amp; Chubaty 2021</a>)</span>, which builds a
folder structure where simulation outputs are conveniently organised.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">graphics.off</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mySimInit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://spades-core.predictiveecology.org/reference/simInit.html">simInit</a></span><span class="op">(</span>times <span class="op">=</span> <span class="va">times</span>, params <span class="op">=</span> <span class="va">parameters</span>, modules <span class="op">=</span> <span class="va">modules</span>,
    objects <span class="op">=</span> <span class="va">objects</span>, paths <span class="op">=</span> <span class="va">paths</span>, outputs <span class="op">=</span> <span class="va">outputs</span><span class="op">)</span>

<span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span>
<span class="va">mySimExperiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://spades-experiment.predictiveecology.org//reference/experiment2.html">experiment2</a></span><span class="op">(</span>sim1 <span class="op">=</span> <span class="va">mySimInit</span>, clearSimEnv <span class="op">=</span> <span class="cn">FALSE</span>,
    replicates <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
</div>
<div id="validate-simulation-outputs-with-biomass_validationknn" class="section level3" number="7.3.5">
<h3>
<span class="header-section-number">7.3.5</span> Validate simulation outputs with <em>Biomass_validationKNN</em><a class="anchor" aria-label="anchor" href="#validate-simulation-outputs-with-biomass_validationknn"><i class="fas fa-link"></i></a>
</h3>
<p>Note that because we ran <em>Biomass_core</em> by itself using theoretical input data,
we can expect the validation to reveal that the module didn’t do a great job at
reproducing observed patterns.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simulationOutputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">mySimExperiment</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,
    <span class="va">localSimPaths</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">oldPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span><span class="op">(</span><span class="fu"><a href="https://spades-core.predictiveecology.org/reference/simList-accessors-paths.html">outputPath</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  <span class="co">## exclude sim*_rep* folder</span>
    <span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu">as.data.table</span><span class="op">(</span><span class="fu"><a href="https://spades-core.predictiveecology.org/reference/simList-accessors-outputs.html">outputs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
    <span class="va">DT</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span><span class="va">file</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="va">oldPath</span>, <span class="va">localSimPaths</span><span class="op">$</span><span class="va">outputPath</span>, <span class="va">file</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
    <span class="va">DT</span>
<span class="op">}</span>, localSimPaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://Require.predictiveecology.org/reference/normPath.html">normPath</a></span><span class="op">(</span><span class="va">paths</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">simulationOutputs</span> <span class="op">&lt;-</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="va">simulationOutputs</span><span class="op">)</span>

<span class="va">validationPaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://Require.predictiveecology.org/reference/normPath.html">normPath</a></span><span class="op">(</span><span class="va">paths</span><span class="op">)</span><span class="op">)</span>
<span class="va">validationPaths</span><span class="op">$</span><span class="va">outputPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">validationPaths</span><span class="op">$</span><span class="va">outputPath</span>,
    <span class="st">"validation"</span><span class="op">)</span>

<span class="va">validationTimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">1</span>, end <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">validationParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Biomass_validationKNN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sppEquivCol <span class="op">=</span> <span class="fu"><a href="https://spades-core.predictiveecology.org/reference/params.html">params</a></span><span class="op">(</span><span class="va">mySimInit</span><span class="op">)</span><span class="op">$</span><span class="va">Biomass_core</span><span class="op">$</span><span class="va">sppEquivCol</span>,
    validationReps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>  <span class="co">## or length of simLists</span>
,
    validationYears <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">2011</span><span class="op">)</span><span class="op">)</span>, .plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"png"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">## make an empty fire polygon object to bypass removing</span>
<span class="co">## fire-disturbed pixels</span>
<span class="va">noFires</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_polygon</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">validationObjects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>biomassMap <span class="op">=</span> <span class="va">mySimExperiment</span><span class="op">$</span><span class="va">sim1_rep1</span><span class="op">$</span><span class="va">biomassMap</span>,
    firePerimeters <span class="op">=</span> <span class="va">noFires</span>, rasterToMatch <span class="op">=</span> <span class="va">mySimExperiment</span><span class="op">$</span><span class="va">sim1_rep1</span><span class="op">$</span><span class="va">rasterToMatch</span>,
    rawBiomassMapStart <span class="op">=</span> <span class="va">mySimExperiment</span><span class="op">$</span><span class="va">sim1_rep1</span><span class="op">$</span><span class="va">biomassMap</span>,
    simulationOutputs <span class="op">=</span> <span class="va">simulationOutputs</span>, speciesLayersStart <span class="op">=</span> <span class="va">mySimExperiment</span><span class="op">$</span><span class="va">sim1_rep1</span><span class="op">$</span><span class="va">speciesLayers</span>,
    sppColorVect <span class="op">=</span> <span class="va">mySimExperiment</span><span class="op">$</span><span class="va">sim1_rep1</span><span class="op">$</span><span class="va">sppColorVect</span>, sppEquiv <span class="op">=</span> <span class="va">mySimExperiment</span><span class="op">$</span><span class="va">sim1_rep1</span><span class="op">$</span><span class="va">sppEquiv</span>,
    studyArea <span class="op">=</span> <span class="va">mySimExperiment</span><span class="op">$</span><span class="va">sim1_rep1</span><span class="op">$</span><span class="va">studyArea</span><span class="op">)</span>

<span class="va">mySimValidation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://spades-core.predictiveecology.org/reference/simInitAnd.html">simInitAndSpades</a></span><span class="op">(</span>times <span class="op">=</span> <span class="va">validationTimes</span>,
    params <span class="op">=</span> <span class="va">validationParams</span>, modules <span class="op">=</span> <span class="st">"Biomass_validationKNN"</span>,
    objects <span class="op">=</span> <span class="va">validationObjects</span>, paths <span class="op">=</span> <span class="va">validationPaths</span>, .studyAreaName <span class="op">=</span> <span class="va">SAname</span><span class="op">)</span></code></pre></div>
<p>Here are some of the output figures automatically produced by
<em>Biomass_validationKNN</em></p>
<div class="figure">
<span style="display:block;" id="fig:fig-Biomass-validationKNNOutPlots"></span>
<img src="modules/Biomass_validationKNN/figures/LandscapeComparisons_PresAbs.png" alt="Biomass_validationKNN automatically generates plots showing a visual comparison between simulated and observed species presences (right) across the landscape, and relative species biomass per pixel (left)." width="70%"><img src="modules/Biomass_validationKNN/figures/PixelComparisons_relB.png" alt="Biomass_validationKNN automatically generates plots showing a visual comparison between simulated and observed species presences (right) across the landscape, and relative species biomass per pixel (left)." width="70%"><p class="caption">
Figure 7.1: <em>Biomass_validationKNN</em> automatically generates plots showing a visual comparison between simulated and observed species presences (right) across the landscape, and relative species biomass per pixel (left).
</p>
</div>
<div class="figure">
<span style="display:block;" id="fig:fig-Biomass-validationKNNOutPlots2"></span>
<img src="modules/Biomass_validationKNN/figures/landscapeMAD.png" alt="A plot of landscape-wide mean absolute deviations (MAD) from (top to bottom) observed mean relative abundance, no. of presences, no. of pixels where the species is dominant and $\Delta$B." width="70%"><p class="caption">
Figure 7.2: A plot of landscape-wide mean absolute deviations (MAD) from (top to bottom) observed mean relative abundance, no. of presences, no. of pixels where the species is dominant and <span class="math inline">\(\Delta\)</span>B.
</p>
</div>
<div class="figure">
<span style="display:block;" id="fig:fig-Biomass-validationKNNOutPlots3"></span>
<img src="modules/Biomass_validationKNN/figures/observedDeltaBDeltaAge.png" alt="Diagnostic plot of observed changes in biomass and age $\Delta$B and $\Delta$Age, respectively)." width="70%"><p class="caption">
Figure 7.3: Diagnostic plot of observed changes in biomass and age <span class="math inline">\(\Delta\)</span>B and <span class="math inline">\(\Delta\)</span>Age, respectively).
</p>
</div>
</div>
</div>
<div id="bvalid-refs" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> References<a class="anchor" aria-label="anchor" href="#bvalid-refs"><i class="fas fa-link"></i></a>
</h2>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
Barros, C., Luo, Y., Chubaty, A.M., Eddy, I.M.S., Micheletti, T., Boisvenue, C., <em>et al.</em> (in review). Empowering ecologists with a PERFICT workflow: Seamlessly linking data, parameterization, prediction, validation and visualization.
</div>
<div class="csl-entry">
Beaudoin, A., Bernier, P.Y., Villemaire, P., Guindon, L. &amp; Guo, X.J. (2017). <a href="https://doi.org/10.23687/EC9E2659-1C29-4DDB-87A2-6ACED147A990">Species composition, forest properties and land cover types across canada’s forests at 250m resolution for 2001 and 2011</a>.
</div>
<div class="csl-entry">
Burton, P.J. &amp; Cumming, S.G. (1995b). Potential effects of climatic change on some western canadian forests, based on phenological enhancements to a patch model of forest succession. <em>Water, Air and Soil Pollution</em>, 82, 401–414.
</div>
<div class="csl-entry">
Burton, P.J. &amp; Cumming, S.G. (1995a). Potential effects of climatic change on some western canadian forests, based on phenological enhancements to a patch model of forest succession. <em>Water, Air and Soil Pollution</em>, 82, 401–414.
</div>
<div class="csl-entry">
Chubaty, A.M. &amp; McIntire, E.J.B. (2019). <em><a href="https://CRAN.R-project.org/package=SpaDES">SpaDES: Develop and run spatially explicit discrete event simulation models</a></em>.
</div>
<div class="csl-entry">
Cosco, J. (2011). <em>COMMON ATTRIBUTE SCHEMA (CAS) FOR FOREST INVENTORIES ACROSS CANADA</em>. BOREAL AVIAN MODELLING PROJECT, CANADIAN BEACONs PROJECT.
</div>
<div class="csl-entry">
Hogg, E.H. (Ted), Brandt, J.P. &amp; Michaelian, M. (2008). <a href="https://doi.org/10.1139/X08-001">Impacts of a regional drought on the productivity, dieback, and biomass of western canadian aspen forests</a>. <em>Canadian Journal of Forest Research</em>, 38, 1373–1384.
</div>
<div class="csl-entry">
Lambert, M.C., Ung, C.H. &amp; Raulier, F. (2005). <a href="http://cdnsciencepub.com/doi/abs/10.1139/x05-112">Canadian national tree aboveground biomass equations</a>. <em>Canadian Journal of Forest Research</em>, 35, 1996–2018.
</div>
<div class="csl-entry">
McIntire, E.J.B. &amp; Chubaty, A.M. (2020). <em><a href="https://reproducible.predictiveecology.org,%20https://github.com/PredictiveEcology/reproducible">Reproducible: A set of tools that enhance reproducibility beyond package management</a></em>.
</div>
<div class="csl-entry">
McIntire, E.J.B. &amp; Chubaty, A.M. (2021). <em><a href="https://github.com/PredictiveEcology/SpaDES.experiment">SpaDES.experiment: Simulation experiments within the SpaDES ecosystem</a></em>.
</div>
<div class="csl-entry">
Messier, C., Parent, S. &amp; Bergeron, Y. (1998). <a href="https://doi.org/10.2307/3237266">Effects of overstory and understory vegetation on the understory light environment in mixed boreal forests</a>. <em>Journal of Vegetation Science</em>, 9, 511–520.
</div>
<div class="csl-entry">
NRCan. (2013). National ecological framework for canada - terrestrial ecozones.
</div>
<div class="csl-entry">
Peng, C., Ma, Z., Lei, X., Zhu, Q., Chen, H., Wang, W., <em>et al.</em> (2011). <a href="https://doi.org/10.1038/nclimate1293">A drought-induced pervasive increase in tree mortality across canada’s boreal forests</a>. <em>Nature Climate Change</em>, 1, 467–471.
</div>
<div class="csl-entry">
Scheller, R.M. &amp; Domingo, J.B. (2011). <em>LANDIS-II model v6.0 <span></span> user guide</em>.
</div>
<div class="csl-entry">
Scheller, R.M. &amp; Domingo, J.B. (2012). <em>LANDIS-II model v6.0 <span></span> conceptual description</em>.
</div>
<div class="csl-entry">
Scheller, R.M. &amp; Miranda, B.R. (2015a). <em>LANDIS-II biomass succession v3.2 extension – user guide</em>.
</div>
<div class="csl-entry">
Scheller, R.M. &amp; Miranda, B.R. (2015b). <em>LANDIS-II biomass succession v3.2 extension <span></span> user guide</em>.
</div>
<div class="csl-entry">
Scheller, R.M. &amp; Mladenoff, D.J. (2004). <a href="https://doi.org/10.1016/j.ecolmodel.2004.01.022">A forest growth and biomass module for a landscape simulation model, LANDIS: design, validation, and application</a>. <em>Ecological Modelling</em>, 180, 211–229.
</div>
<div class="csl-entry">
Stall, S., Yarmey, L., Cutcher-Gershenfeld, J., Hanson, B., Lehnert, K., Nosek, B., <em>et al.</em> (2019). <a href="https://doi.org/10.1038/d41586-019-01720-7">Make scientific data FAIR</a>. <em>Nature</em>, 570, 27–29.
</div>
<div class="csl-entry">
Sturtevant, B.R., Miranda, B.R., Scheller, R.M. &amp; Shinneman, D. (2018). <em>LANDIS-II dynamic fire system extension v3.0 – user guide</em>.
</div>
<div class="csl-entry">
Ung, C.-H., Bernier, P. &amp; Guo, X.-J. (2008). <a href="https://doi.org/10.1139/X07-224">Canadian national biomass equations: New parameter estimates that include british columbia data</a>. <em>Canadian Journal of Forest Research</em>, 38, 1123–1132.
</div>
<div class="csl-entry">
Wickham, H. (2011). <a href="https://doi.org/10.32614/RJ-2011-002">testthat: Get Started with Testing</a>. <em>The R Journal</em>, 3, 5.
</div>
<div class="csl-entry">
Wilkinson, M.D., Dumontier, M., Aalbersberg, Ij.J., Appleton, G., Axton, M., Baak, A., <em>et al.</em> (2016). <a href="https://doi.org/10.1038/sdata.2016.18">The FAIR guiding principles for scientific data management and stewardship</a>. <em>Scientific Data</em>, 3, 160018.
</div>
<div class="csl-entry">
Yang, J., He, H.S., Shifley, S.R., Thompson, F.R. &amp; Zhang, Y. (2011). <a href="https://doi.org/10.1016/j.ecolmodel.2011.04.032">An innovative computer design for modeling forest landscape change in very large spatial extents with fine resolutions</a>. <em>Ecological Modelling</em>, 222, 2623–2630.
</div>
</div>
</div>
</div>
































<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-McIntireChubaty2021" class="csl-entry">
McIntire, E.J.B. &amp; Chubaty, A.M. (2021). <em><a href="https://github.com/PredictiveEcology/SpaDES.experiment">SpaDES.experiment: Simulation experiments within the SpaDES ecosystem</a></em>.
</div>
<div id="ref-StallEtAl2019" class="csl-entry">
Stall, S., Yarmey, L., Cutcher-Gershenfeld, J., Hanson, B., Lehnert, K., Nosek, B., <em>et al.</em> (2019). <a href="https://doi.org/10.1038/d41586-019-01720-7">Make scientific data FAIR</a>. <em>Nature</em>, 570, 27–29.
</div>
<div id="ref-SturtevantEtAl2018" class="csl-entry">
Sturtevant, B.R., Miranda, B.R., Scheller, R.M. &amp; Shinneman, D. (2018). <em>LANDIS-II dynamic fire system extension v3.0 – user guide</em>.
</div>
</div>
<div class="footnotes">
<hr>
<ol start="9">
<li id="fn9"><p>Raw data layers downloaded by the module are saved
in `dataPath(sim)`, which can be controlled via
`options(reproducible.destinationPath = …)`.<a href="landr-biomass_validationknn-module.html#fnref9" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="landr-validation-modules.html"><span class="header-section-number">6</span> LandR Validation Modules</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#landr-biomass_validationknn-module"><span class="header-section-number">7</span> LandR Biomass_validationKNN Module</a></li>
<li>
<a class="nav-link" href="#module-overview-4"><span class="header-section-number">7.1</span> Module Overview</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#quick-links-4"><span class="header-section-number">7.1.1</span> Quick links</a></li>
<li><a class="nav-link" href="#summary-3"><span class="header-section-number">7.1.2</span> Summary</a></li>
<li><a class="nav-link" href="#bvalid-links-modules"><span class="header-section-number">7.1.3</span> Links to other modules</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#module-manual-4"><span class="header-section-number">7.2</span> Module manual</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#bvalid-general-functioning"><span class="header-section-number">7.2.1</span> General functioning</a></li>
<li><a class="nav-link" href="#bvalid-valid"><span class="header-section-number">7.2.2</span> Validation approaches</a></li>
<li><a class="nav-link" href="#bvalid-inputs-list"><span class="header-section-number">7.2.3</span> List of input objects</a></li>
<li><a class="nav-link" href="#bvalid-params-list"><span class="header-section-number">7.2.4</span> List of parameters</a></li>
<li><a class="nav-link" href="#bvalid-outputs-list"><span class="header-section-number">7.2.5</span> List of outputs</a></li>
<li><a class="nav-link" href="#bvalid-sim-flow"><span class="header-section-number">7.2.6</span> Simulation flow and module events</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#bvalid-example"><span class="header-section-number">7.3</span> Usage example</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-spades-and-other-packages.-2"><span class="header-section-number">7.3.1</span> Load SpaDES and other packages.</a></li>
<li><a class="nav-link" href="#get-the-modules"><span class="header-section-number">7.3.2</span> Get the modules</a></li>
<li><a class="nav-link" href="#setup-simulation-2"><span class="header-section-number">7.3.3</span> Setup simulation</a></li>
<li><a class="nav-link" href="#run-simulation"><span class="header-section-number">7.3.4</span> Run simulation</a></li>
<li><a class="nav-link" href="#validate-simulation-outputs-with-biomass_validationknn"><span class="header-section-number">7.3.5</span> Validate simulation outputs with Biomass_validationKNN</a></li>
</ul>
</li>
<li><a class="nav-link" href="#bvalid-refs"><span class="header-section-number">7.4</span> References</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/PredictiveEcology/LandR-Manual/blob/master/modules/Biomass_validationKNN/Biomass_validationKNN2.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/PredictiveEcology/LandR-Manual/edit/master/modules/Biomass_validationKNN/Biomass_validationKNN2.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>LandR Manual</strong>: v. 1.0.0" was written by </p>
<p>Edited by: Ceres Barros, Alex M. Chubaty, Ian M. S. Eddy, Eliot J. B. McIntire</p>. It was last built on Last updated: 2022-06-01.
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
