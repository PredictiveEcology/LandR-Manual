<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 LandR Biomass_speciesParameters Module | LandR Manual</title>
<meta name="description" content="4.0.0.1 Authors: Ian Eddy ian.eddy@nrcan-rncan.gc.ca [aut, cre], Eliot McIntire eliot.mcintire@nrcan-rncan.gc.ca [aut], Ceres Barros ceres.barros@ubc.ca [ctb] This documentation is a work in...">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="Chapter 4 LandR Biomass_speciesParameters Module | LandR Manual">
<meta property="og:type" content="book">
<meta property="og:url" content="https://predictiveecology.github.io/LandR-Manual/landr-biomass_speciesparameters-module.html">
<meta property="og:image" content="https://predictiveecology.github.io/LandR-Manual/figures/LandRHex.png">
<meta property="og:description" content="4.0.0.1 Authors: Ian Eddy ian.eddy@nrcan-rncan.gc.ca [aut, cre], Eliot McIntire eliot.mcintire@nrcan-rncan.gc.ca [aut], Ceres Barros ceres.barros@ubc.ca [ctb] This documentation is a work in...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 LandR Biomass_speciesParameters Module | LandR Manual">
<meta name="twitter:description" content="4.0.0.1 Authors: Ian Eddy ian.eddy@nrcan-rncan.gc.ca [aut, cre], Eliot McIntire eliot.mcintire@nrcan-rncan.gc.ca [aut], Ceres Barros ceres.barros@ubc.ca [ctb] This documentation is a work in...">
<meta name="twitter:image" content="https://predictiveecology.github.io/LandR-Manual/figures/LandRHex.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="v. 1.0.1">LandR Manual</a>:
        <small class="text-muted">v. 1.0.1</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="landr-biomass_core-module.html"><span class="header-section-number">1</span> LandR Biomass_core Module</a></li>
<li><a class="" href="landr-data-and-calibration-modules.html">LandR Data and Calibration Modules</a></li>
<li><a class="" href="landr-biomass_speciesdata-module.html"><span class="header-section-number">2</span> LandR Biomass_speciesData Module</a></li>
<li><a class="" href="landr-biomass_borealdataprep-module.html"><span class="header-section-number">3</span> LandR Biomass_borealDataPrep Module</a></li>
<li><a class="active" href="landr-biomass_speciesparameters-module.html"><span class="header-section-number">4</span> LandR Biomass_speciesParameters Module</a></li>
<li><a class="" href="landr-validation-modules.html">LandR Validation Modules</a></li>
<li><a class="" href="landr-biomass_validationknn-module.html"><span class="header-section-number">5</span> LandR Biomass_validationKNN Module</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/PredictiveEcology/LandR-Manual">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="landr-biomass_speciesparameters-module" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> LandR <em>Biomass_speciesParameters</em> Module<a class="anchor" aria-label="anchor" href="#landr-biomass_speciesparameters-module"><i class="fas fa-link"></i></a>
</h1>
<!-- the following are text references used in captions for LaTeX compatibility -->

<p><a href="https://github.com/PredictiveEcology/Biomass_speciesParameters.git"><img src="modules/Biomass_speciesParameters/figures/moduleVersionBadge.png" alt="module-version-Badge"></a></p>
<p><a href="https://github.com/PredictiveEcology/Biomass_speciesParameters/issues"><img src="modules/Biomass_speciesParameters/figures/issuesBadge.png" alt="Issues-badge"></a></p>
<!-- if knitting to pdf remember to add the pandoc_args: ["--extract-media", "."] option to yml in order to get the badge images -->
<div id="authors-3" class="section level4" number="4.0.0.1">
<h4>
<span class="header-section-number">4.0.0.1</span> Authors:<a class="anchor" aria-label="anchor" href="#authors-3"><i class="fas fa-link"></i></a>
</h4>
<p>Ian Eddy <a href="mailto:ian.eddy@nrcan-rncan.gc.ca" class="email">ian.eddy@nrcan-rncan.gc.ca</a> [aut, cre], Eliot McIntire <a href="mailto:eliot.mcintire@nrcan-rncan.gc.ca" class="email">eliot.mcintire@nrcan-rncan.gc.ca</a> [aut], Ceres Barros <a href="mailto:ceres.barros@ubc.ca" class="email">ceres.barros@ubc.ca</a> [ctb]
<!-- ideally separate authors with new lines, '\n' not working --></p>
<p><strong>This documentation is a work in progress. Potential discrepancies and omissions
may exist for the time being. If you find any, contact us using the “Get help”
link above.</strong></p>
</div>
<div id="module-overview-3" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Module Overview<a class="anchor" aria-label="anchor" href="#module-overview-3"><i class="fas fa-link"></i></a>
</h2>
<div id="quick-links-3" class="section level3" number="4.1.1">
<h3>
<span class="header-section-number">4.1.1</span> Quick links<a class="anchor" aria-label="anchor" href="#quick-links-3"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p><a href="landr-biomass_speciesparameters-module.html#bsppparam-general-functioning">General functioning</a></p></li>
<li><p><a href="landr-biomass_speciesparameters-module.html#bsppparam-inputs-list">List of input objects</a></p></li>
<li><p><a href="landr-biomass_speciesparameters-module.html#bsppparam-params-list">List of parameters</a></p></li>
<li><p><a href="landr-biomass_speciesparameters-module.html#bsppparam-outputs-list">List of outputs</a></p></li>
<li><p><a href="landr-biomass_speciesparameters-module.html#bsppparam-sim-flow">Simulation flow and module events</a></p></li>
</ul>
</div>
<div id="summary-2" class="section level3" number="4.1.2">
<h3>
<span class="header-section-number">4.1.2</span> Summary<a class="anchor" aria-label="anchor" href="#summary-2"><i class="fas fa-link"></i></a>
</h3>
<p>LandR <em>Biomass_speciesParameters</em> (hereafter <em>Biomass_speciesParameters</em>)
calibrates the species’ growth and mortality traits used in <em>Biomass_core</em>, by
matching theoretical species’ growth curves obtained with different trait values
(see <a href="landr-biomass_speciesparameters-module.html#bsppparam-simdata">Simulated species data</a>) against observed growth
curves derived from Permanent Sample Plots (PSP data) across Canada (see
<a href="landr-biomass_speciesparameters-module.html#bsppparam-PSPdata">Permanent sample plot data</a>), to find the combination of
trait values that most closely match the observed curves.</p>
<p>In particular, it directly calibrates the <code>growthcurve</code> and <code>mortalityshape</code>
invariant species traits as well as two new traits <code>inflationFactor</code> and
<code>mANPPproportion</code>, which are used to calibrate previously estimated species
maximum biomass (<code>maxB</code>) and maximum aboveground net primary productivity
(<code>maxANPP</code>) values (see <a href="landr-biomass_speciesparameters-module.html#bsppparam-calib">Parameter estimation/calibration</a>).</p>
<p>This module <strong>will not</strong> obtain other traits nor parameters used in
<em>Biomass_core</em> and so must be used in conjunction with another data/calibration
module that does so (e.g., <em>Biomass_borealDataPrep</em>). It can however be used
stand-alone in an initial developmental phase for easier
inspection of the statistical calibration procedure employed.</p>
<p>As of September 14, 2022, the <em>raw</em> PSP data used in this module is not freely
available, and data sharing agreements must be obtained from the governments of
SK, AB, and BC to obtain it. However, the <em>processed and anonymized</em> PSP data is
provided via a Google Drive folder accessed automatically by the module.</p>
<p><strong>A Google Account is therefore necessary to access the data used for
calibration.</strong></p>
<p>If you do not have a Google Account, or cannot access the data, please report an
issue by clicking on the “Get help” link above.</p>
</div>
<div id="bsppparam-links-modules" class="section level3" number="4.1.3">
<h3>
<span class="header-section-number">4.1.3</span> Links to other modules<a class="anchor" aria-label="anchor" href="#bsppparam-links-modules"><i class="fas fa-link"></i></a>
</h3>
<p><em>Biomass_speciesParameters</em> is intended to be used with another data module,
like <em>Biomass_borealDataPrep</em>, that prepares all other traits and parameters
(including <code>maxB</code> and <code>maxANPP</code>) for <em>Biomass_core</em>. See
<a href="https://rpubs.com/PredictiveEcology/LandR_Module_Ecosystem">here</a> for all
available modules in the LandR ecosystem and select <em>Biomass_speciesParameters</em>
from the drop-down menu to see potential linkages.</p>
<ul>
<li><p><a href="https://github.com/PredictiveEcology/Biomass_borealDataPrep"><em>Biomass_borealDataPrep</em></a>:
prepares all parameters and inputs (including initial landscape conditions)
that <em>Biomass_core</em> needs to run a realistic simulation. Default
values/inputs produced are relevant for boreal forests of Western Canada.
Used upstream from <em>Biomass_speciesParameters</em>;</p></li>
<li><p><a href="https://github.com/PredictiveEcology/Biomass_core"><em>Biomass_core</em></a>: core
forest dynamics simulation module. Used downstream from
<em>Biomass_speciesParameters</em>;</p></li>
</ul>
</div>
</div>
<div id="module-manual-3" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Module manual<a class="anchor" aria-label="anchor" href="#module-manual-3"><i class="fas fa-link"></i></a>
</h2>
<div id="bsppparam-general-functioning" class="section level3" number="4.2.1">
<h3>
<span class="header-section-number">4.2.1</span> General functioning<a class="anchor" aria-label="anchor" href="#bsppparam-general-functioning"><i class="fas fa-link"></i></a>
</h3>
<p>Tree cohort growth and mortality in <em>Biomass_core</em> are essentially determined by
five parameters: the invariant species traits ‘growth curve’ (<code>growthcurve</code>),
‘mortality shape’, (<code>mortalityshape</code>) and <code>longevity</code>, and the spatio-temporally
varying traits maximum biomass (<code>maxB</code>) and maximum aboveground net primary
productivity (<code>maxANPP</code>).</p>
<p>All five traits strongly modulate the shape of species growth curves and so it
is important that they are calibrated to the study area in question.</p>
<p>In addition, the growth and mortality equations used in <em>Biomass_core</em> are non-linear
and their resulting actual biomass accumulation curve is an emergent phenomenon
due to competition effects. This means that the ideal trait/parameter values
should not be estimated solely from single-species growth conditions, as their
resulting dynamics will be different in a multi-species context.</p>
<p><em>Biomass_speciesParameters</em> attempts to address these issues (at
least partially) using a “curve-matching” approach. It fits three non-linear models
(Chapman-Richards, Gompertz, Logistic) as well as a GAMM to<br>
species-level stand biomass derived from permanent sample plot (PSP).
The resulting curves are compared against a large collection of theoretical species
curves, each representing a different set of growth and mortality parameters,
to find the most likely combination of traits.
This also provides a means to calibrate these traits using a dataset that is
independent from the one used to derive initial landscape conditions and initial
values of <code>maxB</code> and <code>maxANPP</code>.</p>
<p>While <code>longevity</code> is adjusted using published values (see
<em>Biomass_borealDataPrep</em> manual), the remaining four parameters are calibrated
using the PSP data. Hence, <em>Biomass_speciesParameters</em> generally follows other
data modules, like <em>Biomass_boreaDataPrep</em>, that prepare other traits such as
<code>longevity</code>, <code>maxB</code> and <code>maxANPP</code>.</p>
<div id="bsppparam-PSPdata" class="section level4" number="4.2.1.1">
<h4>
<span class="header-section-number">4.2.1.1</span> Permanent sample plot data<a class="anchor" aria-label="anchor" href="#bsppparam-PSPdata"><i class="fas fa-link"></i></a>
</h4>
<p><em>Biomass_speciesParameters</em> can use all the PSP data available (note that it may
span several thousands of kilometres), or select the data based on a polygon
(<code>studyAreaANPP</code>; see <a href="landr-biomass_speciesparameters-module.html#bsppparam-inputs-list">List of input objects</a>).</p>
<p>The default PSP data were initially obtained from the National Forest Inventory
(NFI), the Alberta Ministry of Agriculture, the Saskatchewan Ministry of the
Environment, and the British Columbia Ministry of Forests, treated for errors
and standardized into a single data set with the exact location and identifying
attributes anonymized. We only share the randomized and anonymized dataset, as data sharing
agreements must be met to access the raw data.</p>
<p>The data include individual species, diameter at breast height (DBH), and
sometimes tree height measurements for each tree in a plot, as well as stand
age. As part of the standardization process, dead trees were removed from the
dataset. Tree biomass was then estimated by tree species, in <span class="math inline">\(g/m^2\)</span>, using either the DBH-only model or a
DBH-height model from either <span class="citation">Lambert <em>et al.</em> (<a href="landr-biomass_validationknn-module.html#ref-LambertEtAl2005" role="doc-biblioref">2005</a>)</span> or <span class="citation">Ung <em>et al.</em> (<a href="landr-biomass_validationknn-module.html#ref-UngEtAl2008" role="doc-biblioref">2008</a>)</span> (see <code>P(sim)$biomassModel</code> module parameter
in <a href="landr-biomass_speciesparameters-module.html#bsppparam-params-list">list of parameters</a>).</p>
</div>
<div id="bsppparam-simdata" class="section level4" number="4.2.1.2">
<h4>
<span class="header-section-number">4.2.1.2</span> Simulated species data<a class="anchor" aria-label="anchor" href="#bsppparam-simdata"><i class="fas fa-link"></i></a>
</h4>
<p>The <em>Biomass_speciesFactorial</em> module was used to create a library of
theoretical species curves (biomass accumulation curves, to be more precise) to
which the empirical species curves derived from PSP-biomass are matched for each
species trait combination in the study area. The library of curves was
created by running several <em>Biomass_core</em> simulations with no reproduction, competition,
disturbance, or dispersal effects, on the study area. Each simulation differed in
the combination of species trait values that influence growth and mortality
dynamics, namely: <code>growthcurve</code>, <code>mortalityshape</code>, <code>longevity</code>, <code>maxANPP</code> and
maximum biomass (<code>maxBiomass</code>, not to be confused with the data-driven <code>maxB</code>
which is later calibrated).</p>
<p>The values for <code>maxANPP</code> were explored via the <code>mANPPproportion</code>, the ratio of
<code>maxANPP</code> to <code>maxBiomass</code> (the parameter used for theroetical curves), as it
reflects their relationship.</p>
<p><code>growthcurve</code> values varied from 0 to 1, in increments of 0.1; <code>mortalityshape</code>
varied from 5 to 25, in increments of 1; <code>longevity</code> varied from 150 to 700 in
increments of 25; <code>mANPPproportion</code> varied from 0.25 to 10 in increments of
0.25. <code>maxBiomass</code> was held constant at 5000.</p>
<p>This resulted in over 64,000,000 theoretical curves.</p>
<p>Results from these simulations were compiled into a table (<code>cohortDataFactorial</code>
; see <a href="landr-biomass_speciesparameters-module.html#bsppparam-inputs-list">List of input objects</a>) that is accessed by
<em>Biomass_speciesParameters</em>, so that the module can be run without needing to
re-simulate the theoretical curves.</p>
</div>
<div id="bsppparam-calib" class="section level4" number="4.2.1.3">
<h4>
<span class="header-section-number">4.2.1.3</span> Parameter estimation/calibration<a class="anchor" aria-label="anchor" href="#bsppparam-calib"><i class="fas fa-link"></i></a>
</h4>
<p><em>Biomass_speciesParameters</em> calibrates <code>growthcurve</code>, <code>mortalityshape</code> and
<code>mANPPproportion</code> by matching the theoretical species curves produced by
<em>Biomass_speciesFactorial</em> (<code>cohortDataFactorial</code> object) against observed
species growth curves from permanent sample plot (PSP) data.</p>
<p>Before fitting the <em>observed</em> species growth curves, the module subsets the PSP
data to stand ages below the 95th percent quantile for all species (this can be
changed via the <code>P(sim)$quantileAgeSubset</code> module parameter), as records for
larger age classes were limited and constituted statistical outliers. In some
species, changing the quantile value may improve results, however. Two examples
are <em>Pinus banksiana</em> and <em>Populus sp</em>, for which using the 99th percent
quantile improved the models, because these are short-lived species for which
data at advanced ages is scarce.</p>
<p>The module attempts to fit the models using stands where the focal species is
dominant (but not monocultures), while balancing sample size (see <a href="landr-biomass_speciesparameters-module.html#bsppparam-calibbw">biomass
weighting</a> below). Hence, for a given species, it only includes plots where the
species’ relative biomass is at least 50%. This is, when calibrating <em>Populus
tremuloides</em> traits, PSP daa plots are only included if 50% of the stand biomass
is composed of <em>P. tremuloides</em>.</p>
<p>In addition, 50 points are added at the origin (age = 0 and biomass = 0) to
force the intercept to be essentially 0 age and 0 biomass.</p>
<p>Observed growth curves for each species are then fit using generalized additive
mixed models (GAMMs) that relate species biomass (<span class="math inline">\(B\)</span>) with stand age
(<span class="math inline">\(standAge\)</span>), accounting for the random effects of the measurement year
(<span class="math inline">\(measureYear\)</span>) and plot (<span class="math inline">\(plotID\)</span>) on the intercept:</p>
<span class="math display" id="eq:GAMM">\[\begin{equation}
B \sim f_{1}(standAge) + (\sim 1 | measureYear + plotID)
\tag{4.1}
\end{equation}\]</span>
<p>where <span class="math inline">\(f_{1}\)</span> denotes the smoother function. To avoid overfitting, the module
constrains the smoother on stand age to a maximum smoothing degree of 3 (i.e. 3
knots and a polynomial degree of 2) and a default point constraint at 0 that attempts to
force the intercept to 0. The smoother degree constraint, however,
can be changed via the <code>P(sim)$GAMMknots</code> module parameter.</p>
<div id="bsppparam-calibbw" class="section level5" number="4.2.1.3.1">
<h5>
<span class="header-section-number">4.2.1.3.1</span> Biomass-weighting<a class="anchor" aria-label="anchor" href="#bsppparam-calibbw"><i class="fas fa-link"></i></a>
</h5>
<p>In addition, <span class="math inline">\(B\)</span> is weighted with respect to species dominance. This consisted
in 1) calculating the average biomass of each dominant species (i.e. relative
biomass in a plot &gt; 0.5; <span class="math inline">\(domSpeciesB_{1}\)</span>), in each plot and measurement year,
and 2) dividing the species average biomass by the average biomass across all
<em>n</em> dominant species (<span class="math inline">\(allDomSpeciesB\)</span>):</p>
<span class="math display" id="eq:Bweights">\[\begin{equation}
\frac{\overline{\rm domSpeciesB_{1}}}{\overline{\rm allDomSpeciesB}}
\tag{4.2}
\end{equation}\]</span>
<p>For the added 0 age and 0 biomass data the module uses weights equal to 1.</p>
<p>It is possible that some selected species do not have enough data to allow for
model convergence. In this case, <em>Biomass_speciesParameters</em> skips trait
(re-)calibration, and values remain unchanged.</p>
<p>After fitting each species GAMM, <em>Biomass_speciesParameters</em> compares it to the
theoretical curves obtained with a <code>longevity</code> value that matches the focal
species’ longevity, and picks the best one based on maximum likelihood. This best
theoretical curve will be associated with a given combination of <code>growthcurve</code>,
<code>mortalityshape</code> and <code>mANPPproportion</code> values, which are then used directly as
the calibrated values, in case of <code>growthcurve</code> and <code>mortalityshape</code>, or to
calibrate <code>maxANPP</code> in the case of <code>mANPPproportion</code> (see below).</p>
<p>The user has the option to constrain the values of the <code>growthcurve</code> and
<code>mortalityshape</code> parameters. By default, <code>growthcurve</code> is forced to 0.5,
<code>mortalityshape</code> is allowed to vary between 15 and 25, and <code>mANPPproportion</code>
between 2.0 and 5.0 (see module parameters <code>P(sim)$constrainGrowthCurve</code>,
<code>P(sim)constrainMortalityShape</code> and <code>P(sim)constrainMaxANPP</code>). These boundary
values were based on preliminary runs and analyses using the default data and
may not apply to other data sets, or to different spatial subsets of the default
data.</p>
<p>If boundary values are used, <em>Biomass_speciesParameters</em> subsets the theoretical
species growth curves to those with trait values within the selected boundaries.</p>
<p>Since simulated growth curves never achieve the maximum biomass parameter (the
<code>maxBiomass</code> parameter set to 5000 for all simulations of theoretical species
curves, or the <code>maxB</code> parameter in <em>Biomass_core</em> simulations), it acts as an
asymptotic limit that reflects the potential maximum biomass for a species in an
ecolocation (ecological zone and land cover combination).</p>
<p><em>Biomass_speciesParameters</em> uses the ratio between the potential maximum biomass
(<code>maxBiomass</code>, always 5000) to the achieved maximum biomass in the theoretical
curves, to rescale <code>maxB</code>. This ratio is called the <code>inflationFactor</code> and it is
multiplied by <code>maxB</code> values previously estimated from data (e.g. by
<em>Biomass_borealDataPrep</em>). This way, species simulated in <em>Biomass_core</em> are
able to achieve the maximum observed biomasses used to <em>initially</em> estimate
<code>maxB</code>.</p>
<p>Finally, the module calibrates <code>maxANPP</code> using the <code>mANPPproportion</code> value from
the best matching theoretical growth curve as:</p>
<span class="math display" id="eq:maxANPPcalib">\[\begin{equation}
maxB \times \frac{mANPPproportion}{100}
\tag{4.3}
\end{equation}\]</span>
<p>where <code>maxB</code> is the already (re-)calibrated version. As already stated above, the
final <code>maxANPP</code> value is then constrained between 2.0 and 5.0 by default.</p>
<p>In cases where insufficient PSP data prevent fitting the GAMMs and performing
the calibration, <code>mANPPproportion</code> defaults to 3.33 (the value used in LANDIS-II
applications in Canada’s boreal forests) and the <code>inflationFactor</code> to 1.</p>
</div>
</div>
</div>
<div id="bsppparam-inputs-list" class="section level3" number="4.2.2">
<h3>
<span class="header-section-number">4.2.2</span> List of input objects<a class="anchor" aria-label="anchor" href="#bsppparam-inputs-list"><i class="fas fa-link"></i></a>
</h3>
<p>The full list of input objects required by the module is presented below (Table
<a href="landr-biomass_speciesparameters-module.html#tab:moduleInputs2-Biomass-speciesParameters">4.1</a>). The only input that
<strong>must</strong> be provided is <code>studyAreaANPP</code> (the study area used extract the PSP
data from). All other input objects have internal defaults, but the user may
need to request access to their online files.</p>
<p>Of these inputs, the following are particularly important and deserve special
attention:</p>
<p><strong>Spatial layers</strong></p>
<ul>
<li>
<code>studyAreaANPP</code> – shapefile. A <code>SpatialPolygonsDataFrame</code> with a single
polygon determining the where the PSP should be subset to simulation will
take place. This input object <strong>must be supplied by the user or another module</strong>.</li>
</ul>
<p><strong>Tables</strong></p>
<ul>
<li>
<code>factorialSpeciesTable</code> and <code>reducedFactorialCohortData</code> – a tables of
species trait combinations and the theoretical species grwoth curve data
(respectively).</li>
<li>
<code>PSPmeasure</code>, <code>PSPplot</code> and <code>PSPgis</code> – tree measurement, biomass growth and
geographical data of the PSP datasets used to build observed species growth
curves.</li>
<li>
<code>species</code> – a table of invariant species traits that may have been produced
by another module. It <strong>must</strong> contain the columns ‘species’, ‘growthcurve’
and ‘mortality shape’, whose values will be calibrated.</li>
<li>
<code>speciesEcoregion</code> – table of spatially-varying species traits that may
have been produced by another module. It <strong>must</strong> contain the columns
‘speciesCode’, ‘maxB’ and ‘maxANPP’ and ‘ecoregionGroup’ (the ecolocation
ID). ‘maxB’ and ‘maxANPP’ values are (re-)calibrated by species.</li>
</ul>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:moduleInputs2-Biomass-speciesParameters">Table 4.1: </span>List of <em>Biomass_speciesParameters</em> input objects and their description.
</caption>
<thead><tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
objectClass
</th>
<th style="text-align:left;">
desc
</th>
<th style="text-align:left;">
sourceURL
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
speciesTableFactorial
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
table with species traits for matching to <code>cohortDataFactorial</code>
</td>
<td style="text-align:left;">
<a href="https://drive.google.com/open?id=1q0ou0CBzD9GqGSparpHqf318IWK6ycty" class="uri">https://drive.google.com/open?id=1q0ou0CBzD9GqGSparpHqf318IWK6ycty</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
cohortDataFactorial
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
results of factorial species trait simulation. This can be found by running <code>SpeciesFactorial.R</code> but requires a specific commit of Biomass_core
</td>
<td style="text-align:left;">
<a href="https://drive.google.com/open?id=1h8StXE0vm8xyDycRomCkwIaL7wfh5Irj" class="uri">https://drive.google.com/open?id=1h8StXE0vm8xyDycRomCkwIaL7wfh5Irj</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
PSPmeasure_sppParams
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
merged PSP and TSP individual tree measurements. Must include the following columns: MeasureID, OrigPlotID1, MeasureYear, TreeNumber, Species, DBH and newSpeciesName the latter corresponding to species names in <code>LandR::sppEquivalencies_CA$PSP</code>. Defaults to randomized PSP data stripped of real plotIDs
</td>
<td style="text-align:left;">
<a href="https://drive.google.com/file/d/1LmOaEtCZ6EBeIlAm6ttfLqBqQnQu4Ca7/view?usp=sharing" class="uri">https://drive.google.com/file/d/1LmOaEtCZ6EBeIlAm6ttfLqBqQnQu4Ca7/view?usp=sharing</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
PSPplot_sppParams
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
merged PSP and TSP plot data. Defaults to randomized PSP data stripped of real plotIDs. Must contain fields ‘MeasureID’, ‘MeasureYear’, ‘OrigPlotID1’, and ‘baseSA’ the latter being stand age at year of first measurement
</td>
<td style="text-align:left;">
<a href="https://drive.google.com/file/d/1LmOaEtCZ6EBeIlAm6ttfLqBqQnQu4Ca7/view?usp=sharing" class="uri">https://drive.google.com/file/d/1LmOaEtCZ6EBeIlAm6ttfLqBqQnQu4Ca7/view?usp=sharing</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
PSPgis_sppParams
</td>
<td style="text-align:left;">
sf
</td>
<td style="text-align:left;">
Plot location sf object. Defaults to PSP data stripped of real plotIDs/location. Must include field ‘OrigPlotID1’ for joining to PSPplot object
</td>
<td style="text-align:left;">
<a href="https://drive.google.com/file/d/1LmOaEtCZ6EBeIlAm6ttfLqBqQnQu4Ca7/view?usp=sharing" class="uri">https://drive.google.com/file/d/1LmOaEtCZ6EBeIlAm6ttfLqBqQnQu4Ca7/view?usp=sharing</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
a table of invariant species traits with the following trait colums: ‘species’, ‘Area’, ‘longevity’, ‘sexualmature’, ‘shadetolerance’, ‘firetolerance’, ‘seeddistance_eff’, ‘seeddistance_max’, ‘resproutprob’, ‘mortalityshape’, ‘growthcurve’, ‘resproutage_min’, ‘resproutage_max’, ‘postfireregen’, ‘wooddecayrate’, ‘leaflongevity’ ‘leafLignin’, ‘hardsoft’. Only ‘growthcurve’ and ‘mortalityshape’ are used in this module. Default is from Dominic Cyr and Yan Boulanger’s project
</td>
<td style="text-align:left;">
<a href="https://raw.githubusercontent.com/dcyr/LANDIS-II_IA_generalUseFiles/master/speciesTraits.csv" class="uri">https://raw.githubusercontent.com/dcyr/LANDIS-II_IA_generalUseFiles/master/speciesTraits.csv</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesEcoregion
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
table of spatially-varying species traits (<code>maxB</code>, <code>maxANPP</code>, <code>establishprob</code>), defined by species and <code>ecoregionGroup</code>) Defaults to a dummy table based on dummy data os biomass, age, ecoregion and land cover class
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquiv
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
table of species equivalencies. See <code><a href="https://landr.predictiveecology.org/reference/sppEquivalencies_CA.html">?LandR::sppEquivalencies_CA</a></code>.
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
studyAreaANPP
</td>
<td style="text-align:left;">
SpatialPolygonsDataFrame
</td>
<td style="text-align:left;">
study area used to crop PSP data before building growth curves
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="bsppparam-params-list" class="section level3" number="4.2.3">
<h3>
<span class="header-section-number">4.2.3</span> List of parameters<a class="anchor" aria-label="anchor" href="#bsppparam-params-list"><i class="fas fa-link"></i></a>
</h3>
<p>The full list of parameters used by the module is presented below (Table
<a href="landr-biomass_speciesparameters-module.html#tab:moduleParams2-Biomass-speciesParameters">4.2</a>), all of which have default
values specified in the module’s metadata.</p>
<p>Of these parameters, the following are particularly important:</p>
<p><strong>Calibration parameters</strong></p>
<ul>
<li><p><code>GAMMiterations</code> and <code>GAMMknots</code> – control the number of iterations and
smoother degree used to fit the GAMMs, respectively.</p></li>
<li><p><code>constrainGrowthCurve</code>, <code>constrainMortalityShape</code> and <code>constrainMaxANPP</code> –
determine the upper and lower boundaries of the calibrated values of
<code>growthcurve</code>, <code>mortalityshape</code> and <code>maxANPP</code>, respectively.</p></li>
</ul>
<p><strong>Data processing</strong></p>
<ul>
<li><p><code>minimumPlotsPerGamm</code> – define a minimum number of PSP plots needed to fit
the GAMMs.</p></li>
<li><p><code>PSPperiod</code> – PSP data period to use.</p></li>
<li><p><code>quantileAgeSubset</code> – upper quantile age value used to subset PSP data.</p></li>
</ul>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:moduleParams2-Biomass-speciesParameters">Table 4.2: </span>List of <em>Biomass_speciesParameters</em> parameters and their description.
</caption>
<thead><tr>
<th style="text-align:left;">
paramName
</th>
<th style="text-align:left;">
paramClass
</th>
<th style="text-align:left;">
default
</th>
<th style="text-align:left;">
min
</th>
<th style="text-align:left;">
max
</th>
<th style="text-align:left;">
paramDesc
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
.plots
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
screen
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Used by Plots function, which can be optionally used here
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInitialTime
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
start(sim)
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This describes the simulation time at which the first plot event should occur
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInterval
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This describes the simulation time interval between plot events
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInitialTime
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This describes the simulation time at which the first save event should occur
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInterval
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This describes the simulation time interval between save events
</td>
</tr>
<tr>
<td style="text-align:left;">
.useCache
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
.inputOb….
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Should this entire module be run with caching activated? This is generally intended for data-type modules, where stochasticity and time are not relevant
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesFittingApproach
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
pairwise
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Either ‘all’, ‘pairwise’, ‘focal’ or ‘single’, indicating whether to pool all species into one fit, do pairwise species (for multiple cohort situations), do pairwise species, but using a focal species approach where all other species are pooled into ‘other’ or do one species at a time. If ‘all’, all species will have identical species-level traits
</td>
</tr>
<tr>
<td style="text-align:left;">
biomassModel
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
Lambert2005
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The model used to calculate biomass from DBH. Can be either ‘Lambert2005’ or ‘Ung2008’
</td>
</tr>
<tr>
<td style="text-align:left;">
constrainGrowthCurve
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
0, 1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
upper and lower bounds on range of potential growth curves when fitting traits. This module accepts a list of vectors, with names equal to <code>sppEquivCol</code>, so that traits are customizable
</td>
</tr>
<tr>
<td style="text-align:left;">
constrainMortalityShape
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
15, 25
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
upper and lower bounds on mortality shape when fitting traits. low mortality curve needs to excessive cohorts with very little biomass as longevity is approached, adding computation strain. alternatively accepts a list of vectors, with names equal to <code>sppEquivCol</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
constrainMaxANPP
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
2, 5
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
upper and lower bounds on <code>maxANPP</code> when fitting traits. cohorts are initiated with <code>B = maxANPP</code> which may be unreasonably high if <code>maxANPP</code> is also high. Both <code>maxANPP</code> and growthcurve params control when <code>maxB</code> is reached. High <code>maxANPP</code> results in earlier peaks alternatively accepts a list of vectors, with names equal to <code>sppEquivCol</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
GAMMiterations
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
number of iterations for GAMMs. This module accepts a list of vectors, with names equal to <code>sppEquivCol</code>, so that GAMMs are customizable
</td>
</tr>
<tr>
<td style="text-align:left;">
GAMMknots
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
the number of knots to use in the GAMM. Either 3 or 4 is recommended. This module accepts a list of vectors, with names equal to <code>sppEquivCol</code>, so that GAMMS are customizable
</td>
</tr>
<tr>
<td style="text-align:left;">
minimumPlotsPerGamm
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
minimum number of PSP plots before building GAMM
</td>
</tr>
<tr>
<td style="text-align:left;">
minDBH
</td>
<td style="text-align:left;">
integer
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
minimum diameter at breast height (DBH) in cm used to filter PSP data. Defaults to 0 cm, i.e. all tree measurements are used.
</td>
</tr>
<tr>
<td style="text-align:left;">
PSPdataTypes
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
all
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Which PSP datasets to source, defaulting to all. Other available options include ‘BC’, ‘AB’, ‘SK’, ‘NFI’, and ‘dummy’. ‘dummy’ should be used for unauthorized users.
</td>
</tr>
<tr>
<td style="text-align:left;">
PSPperiod
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
1920, 2019
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The years by which to subset sample plot data, if desired. Must be a vector of length 2
</td>
</tr>
<tr>
<td style="text-align:left;">
quantileAgeSubset
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
95
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
quantile by which to subset PSP data. As older stands are sparsely represented, the oldest measurements become vastly more influential. This parameter accepts both a single value and a list of vectors named by <code>sppEquivCol.</code> The PSP stand ages are found in <code>sim$speciesGAMMs$SPECIES$originalData</code>, where SPECIES is the species ID
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquivCol
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
default
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The column in <code>sim$sppEquiv</code> data.table to group species by. This parameter should share the same name as in Biomass_borealDataPrep . PSPs are aggregated by names in the PSP column and traits estimated for the corresponding names in the <code>sppEquivCol</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
useHeight
</td>
<td style="text-align:left;">
logical
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Should height be used to calculate biomass (in addition to DBH). Advise against including height unless you are certain it is present in every PSP
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="bsppparam-outputs-list" class="section level3" number="4.2.4">
<h3>
<span class="header-section-number">4.2.4</span> List of outputs<a class="anchor" aria-label="anchor" href="#bsppparam-outputs-list"><i class="fas fa-link"></i></a>
</h3>
<p>The module produces the following outputs (Table
<a href="landr-biomass_borealdataprep-module.html#tab:moduleOutputs-Biomass-borealDataPrep">3.4</a>). Note that <code>species</code> and
<code>speciesEcoregion</code> are modified versions of the inputed objects with the same
name.</p>
<p><strong>Tables</strong></p>
<ul>
<li><p><code>species</code> and <code>speciesEcoregion</code> – tables with calibrated trait values.</p></li>
<li><p><code>speciesGAMMs</code> – the fitted GAMM model objects for each species.</p></li>
</ul>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:moduleOutputs-Biomass-speciesParameters">Table 4.3: </span>List of <em>Biomass_speciesParameters</em> output objects and their description.
</caption>
<thead><tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
objectClass
</th>
<th style="text-align:left;">
desc
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
updated invariant species traits.
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesEcoregion
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
table of updated spatially-varying species traits
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesGAMMs
</td>
<td style="text-align:left;">
list
</td>
<td style="text-align:left;">
a list of mixed-effect general additive models (GAMMs) for each tree species modeling biomass as a function of age
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="bsppparam-sim-flow" class="section level3" number="4.2.5">
<h3>
<span class="header-section-number">4.2.5</span> Simulation flow and module events<a class="anchor" aria-label="anchor" href="#bsppparam-sim-flow"><i class="fas fa-link"></i></a>
</h3>
<p><em>Biomass_speciesParameters</em> initialies itself and prepares all inputs provided
there is an active internet connection and the user has access to the data (and
a Google Account to do so).</p>
<p>We advise future users to run <em>Biomass_speciesParameters</em> with defaults and
inspect what the objects are like before supplying their own data. The user does
not need to run <em>Biomass_speciesFactorial</em> to generate their own theoretical
curves (unless they wish to), as the module accesses a pre-generated on-line
library with these simulated data.</p>
<p>Note that this module only runs once (in one “time step”) and only executes one
event (<code>init</code>). The general flow of <em>Biomass_speciesParameters</em> processes is:</p>
<ol style="list-style-type: decimal">
<li><p>Preparation of all necessary data and input objects that do not require
parameter fitting (e.g., the theoretical species growth curve data);</p></li>
<li><p>Sub-setting PSP data and calculating the observed species growth curves
using GAMMs;</p></li>
<li><p>Finding the theoretical species growth curve that best matches the observed
curve, for each species. Theoretical curves are subset to those with longevity
matching the species’ longevity (in <code>species</code> table) and with
<code>growthcurve</code> and <code>mortalityshape</code> values within the chosen boundaries
(<code>P(sim)$constrainGrowthCurve</code>, <code>P(sim)$constrainMortalityShape</code>);</p></li>
<li><p>Calibrating <code>maxB</code> and <code>maxANPP</code></p></li>
<li><p>Adjusting <code>maxANPP</code> to match the chosen boundaries
(<code>P(sim)$constrainMaxANPP</code>)</p></li>
</ol>
</div>
</div>
<div id="bsppparam-example" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Usage example<a class="anchor" aria-label="anchor" href="#bsppparam-example"><i class="fas fa-link"></i></a>
</h2>
<p>This module can be run stand-alone, but it won’t do much more than calibrate
species trait values based on dummy input trait values. We provide an example of
this below, since it may be of value to run the module by itself to become
acquainted with the calibration process and explore the fitted GAMMs. However,
we remind that to run this example you will need a Google Account, and access to
the data may need to be granted.</p>
<p>A realistic usage example of this module and a few others can be found in <a href="https://github.com/CeresBarros/LandRBiomass_publication">this
repository</a> and in
<span class="citation">Barros <em>et al.</em> (<a href="landr-biomass_validationknn-module.html#ref-BarrosEtAlinreview" role="doc-biblioref">in review</a>)</span>.</p>
<div id="load-spades-and-other-packages.-1" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> Load <code>SpaDES</code> and other packages.<a class="anchor" aria-label="anchor" href="#load-spades-and-other-packages.-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://Require.predictiveecology.org">Require</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"Require"</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://Require.predictiveecology.org">Require</a></span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://Require.predictiveecology.org/reference/Require.html">Require</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PredictiveEcology/SpaDES.install"</span>, <span class="st">"SpaDES"</span>, <span class="st">"PredictiveEcology/SpaDES.core@development"</span><span class="op">)</span>,
    install_githubArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="get-module-necessary-packages-and-set-up-folder-directories-1" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> Get module, necessary packages and set up folder directories<a class="anchor" aria-label="anchor" href="#get-module-necessary-packages-and-set-up-folder-directories-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tempDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>inputPath <span class="op">=</span> <span class="fu"><a href="https://Require.predictiveecology.org/reference/normPath.html">normPath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>, <span class="st">"inputs"</span><span class="op">)</span><span class="op">)</span>,
    cachePath <span class="op">=</span> <span class="fu"><a href="https://Require.predictiveecology.org/reference/normPath.html">normPath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>, <span class="st">"cache"</span><span class="op">)</span><span class="op">)</span>, modulePath <span class="op">=</span> <span class="fu"><a href="https://Require.predictiveecology.org/reference/normPath.html">normPath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>,
        <span class="st">"modules"</span><span class="op">)</span><span class="op">)</span>, outputPath <span class="op">=</span> <span class="fu"><a href="https://Require.predictiveecology.org/reference/normPath.html">normPath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>,
        <span class="st">"outputs"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">getModule</span><span class="op">(</span><span class="st">"PredictiveEcology/Biomass_speciesParameters@79896a4e3b785e34e5f509798ab6c2204bb334d7"</span>,
    modulePath <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">modulePath</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## make sure all necessary packages are installed:</span>
<span class="fu">makeSureAllPackagesInstalled</span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">modulePath</span><span class="op">)</span></code></pre></div>
</div>
<div id="setup-simulation-1" class="section level3" number="4.3.3">
<h3>
<span class="header-section-number">4.3.3</span> Setup simulation<a class="anchor" aria-label="anchor" href="#setup-simulation-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://spades.predictiveecology.org">SpaDES</a></span><span class="op">)</span>

<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0</span>, end <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">modules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Biomass_speciesParameters"</span><span class="op">)</span>

<span class="co"># the purpose of this table is experiment with modify</span>
<span class="co"># longevity - longevity is not estimated by the module but</span>
<span class="co"># it is used in trait estimation.</span>
<span class="va">inputSpecies</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Abie_bal"</span>, <span class="st">"Abie_las"</span>,
    <span class="st">"Betu_pap"</span>, <span class="st">"Lari_lar"</span>, <span class="st">"Pice_eng"</span>, <span class="st">"Pice_gla"</span>, <span class="st">"Pice_mar"</span>,
    <span class="st">"Pinu_ban"</span>, <span class="st">"Pinu_con"</span>, <span class="st">"Pseu_men"</span>, <span class="st">"Popu_tre"</span><span class="op">)</span>, longevity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">300</span>,
    <span class="fl">300</span>, <span class="fl">170</span>, <span class="fl">170</span>, <span class="fl">330</span>, <span class="fl">250</span>, <span class="fl">250</span>, <span class="fl">175</span>, <span class="fl">300</span>, <span class="fl">600</span>, <span class="fl">200</span><span class="op">)</span>, mortalityshape <span class="op">=</span> <span class="fl">15</span>,
    growthcurve <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">objects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>species <span class="op">=</span> <span class="va">inputSpecies</span><span class="op">)</span>

<span class="va">inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">outputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Biomass_speciesParameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>GAMMiterations <span class="op">=</span> <span class="fl">2</span>,
    GAMMknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Abie_bal <span class="op">=</span> <span class="fl">3</span>, Abie_las <span class="op">=</span> <span class="fl">3</span>, Betu_pap <span class="op">=</span> <span class="fl">3</span>,
        Lari_lar <span class="op">=</span> <span class="fl">4</span>, Pice_eng <span class="op">=</span> <span class="fl">4</span>, Pice_gla <span class="op">=</span> <span class="fl">3</span>, Pice_mar <span class="op">=</span> <span class="fl">4</span>,
        Pinu_ban <span class="op">=</span> <span class="fl">3</span>, Pinu_con <span class="op">=</span> <span class="fl">4</span>, Popu_tre <span class="op">=</span> <span class="fl">4</span>, Pseu_men <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,
    minimumPlotsPerGamm <span class="op">=</span> <span class="fl">40</span>, constrainMortalityShape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Abie_bal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>,
        <span class="fl">25</span><span class="op">)</span>, Abie_las <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">25</span><span class="op">)</span>, Betu_pap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>, Lari_lar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>,
        <span class="fl">25</span><span class="op">)</span>, Pice_eng <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">25</span><span class="op">)</span>, Pice_gla <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">25</span><span class="op">)</span>, Pice_mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>,
        <span class="fl">25</span><span class="op">)</span>, Pinu_ban <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">25</span><span class="op">)</span>, Pinu_con <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">25</span><span class="op">)</span>, Popu_tre <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>,
        <span class="fl">25</span><span class="op">)</span>, Pseu_men <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>, constrainGrowthCurve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Abie_bal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,
        <span class="fl">1</span><span class="op">)</span>, Abie_las <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, Betu_pap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, Lari_lar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,
        <span class="fl">1</span><span class="op">)</span>, Pice_eng <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, Pice_gla <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, Pice_mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,
        <span class="fl">1</span><span class="op">)</span>, Pinu_ban <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, Pinu_con <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, Popu_tre <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,
        <span class="fl">1</span><span class="op">)</span>, Pseu_men <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, quantileAgeSubset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Abie_bal <span class="op">=</span> <span class="fl">95</span>,
        Abie_las <span class="op">=</span> <span class="fl">95</span>, Betu_pap <span class="op">=</span> <span class="fl">95</span>, Lari_lar <span class="op">=</span> <span class="fl">95</span>, Pice_eng <span class="op">=</span> <span class="fl">95</span>,
        Pice_gla <span class="op">=</span> <span class="fl">95</span>, Pice_mar <span class="op">=</span> <span class="fl">95</span>, Pinu_ban <span class="op">=</span> <span class="fl">95</span>, Pinu_con <span class="op">=</span> <span class="fl">99</span>,
        Popu_tre <span class="op">=</span> <span class="fl">99</span>, Pseu_men <span class="op">=</span> <span class="fl">99</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>


<span class="va">mySim</span> <span class="op">&lt;-</span> <span class="fu">simInitAndSpades</span><span class="op">(</span>times <span class="op">=</span> <span class="va">times</span>, params <span class="op">=</span> <span class="va">parameters</span>,
    modules <span class="op">=</span> <span class="va">modules</span>, paths <span class="op">=</span> <span class="va">paths</span>, objects <span class="op">=</span> <span class="va">objects</span><span class="op">)</span>

<span class="co">## to inspect the fitted GAMM models:</span>
<span class="va">mySim</span><span class="op">$</span><span class="va">speciesGAMMs</span><span class="op">$</span><span class="va">Pice_mar</span></code></pre></div>
</div>
</div>
<div id="bsppparam-refs" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> References<a class="anchor" aria-label="anchor" href="#bsppparam-refs"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="landr-biomass_borealdataprep-module.html"><span class="header-section-number">3</span> LandR Biomass_borealDataPrep Module</a></div>
<div class="next"><a href="landr-validation-modules.html">LandR Validation Modules</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#landr-biomass_speciesparameters-module"><span class="header-section-number">4</span> LandR Biomass_speciesParameters Module</a></li>
<li>
<a class="nav-link" href="#module-overview-3"><span class="header-section-number">4.1</span> Module Overview</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#quick-links-3"><span class="header-section-number">4.1.1</span> Quick links</a></li>
<li><a class="nav-link" href="#summary-2"><span class="header-section-number">4.1.2</span> Summary</a></li>
<li><a class="nav-link" href="#bsppparam-links-modules"><span class="header-section-number">4.1.3</span> Links to other modules</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#module-manual-3"><span class="header-section-number">4.2</span> Module manual</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#bsppparam-general-functioning"><span class="header-section-number">4.2.1</span> General functioning</a></li>
<li><a class="nav-link" href="#bsppparam-inputs-list"><span class="header-section-number">4.2.2</span> List of input objects</a></li>
<li><a class="nav-link" href="#bsppparam-params-list"><span class="header-section-number">4.2.3</span> List of parameters</a></li>
<li><a class="nav-link" href="#bsppparam-outputs-list"><span class="header-section-number">4.2.4</span> List of outputs</a></li>
<li><a class="nav-link" href="#bsppparam-sim-flow"><span class="header-section-number">4.2.5</span> Simulation flow and module events</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#bsppparam-example"><span class="header-section-number">4.3</span> Usage example</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-spades-and-other-packages.-1"><span class="header-section-number">4.3.1</span> Load SpaDES and other packages.</a></li>
<li><a class="nav-link" href="#get-module-necessary-packages-and-set-up-folder-directories-1"><span class="header-section-number">4.3.2</span> Get module, necessary packages and set up folder directories</a></li>
<li><a class="nav-link" href="#setup-simulation-1"><span class="header-section-number">4.3.3</span> Setup simulation</a></li>
</ul>
</li>
<li><a class="nav-link" href="#bsppparam-refs"><span class="header-section-number">4.4</span> References</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/PredictiveEcology/LandR-Manual/blob/master/modules/Biomass_speciesParameters/Biomass_speciesParameters2.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/PredictiveEcology/LandR-Manual/edit/master/modules/Biomass_speciesParameters/Biomass_speciesParameters2.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>LandR Manual</strong>: v. 1.0.1" was written by </p>
<p>Edited by: Ceres Barros, Alex M. Chubaty, Ian M. S. Eddy, Eliot J. B. McIntire</p>. It was last built on Last updated: 2022-09-14.
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
